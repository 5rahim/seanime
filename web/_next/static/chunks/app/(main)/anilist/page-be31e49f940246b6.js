(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[424],{14398:function(e,t,n){Promise.resolve().then(n.bind(n,48289))},48289:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return Home}});var r=n(57437),i=n(2265),a=n(76732),s=n(54487),l=n(77665),o=n(23890),u=n(7214),d=n(11305),c=n(68260),m=n(51864),v=n.n(m),f=n(90466),b=n(88356),h=n(34654);let g=(0,l.cn)(0),x=(0,l.cn)("");function anilist_filterEntriesByTitle(e,t){if(e.length>0&&t.length>0){let n=t.toLowerCase().trim().replace(/\s+/g," ");return e.filter(e=>{var t,r,i,a,s,l,o,u,d,c,m;return(null===(i=e.media)||void 0===i?void 0:null===(r=i.title)||void 0===r?void 0:null===(t=r.english)||void 0===t?void 0:t.toLowerCase().includes(n))||(null===(l=e.media)||void 0===l?void 0:null===(s=l.title)||void 0===s?void 0:null===(a=s.userPreferred)||void 0===a?void 0:a.toLowerCase().includes(n))||(null===(d=e.media)||void 0===d?void 0:null===(u=d.title)||void 0===u?void 0:null===(o=u.romaji)||void 0===o?void 0:o.toLowerCase().includes(n))||(null===(m=e.media)||void 0===m?void 0:null===(c=m.synonyms)||void 0===c?void 0:c.some(e=>null==e?void 0:e.toLowerCase().includes(n)))})}return e}function Home(){let[e,t]=(0,o.KO)(g),[n,l]=(0,i.useTransition)(),{anilistLists:u}=(0,c.uJ)(),m=(0,o.Dv)(x),f=(0,h.N)(m,500),b=(0,i.useMemo)(()=>u.map(e=>{if(!e)return;let t=null==e?void 0:e.entries;return t=v()(t,e=>{var t,n;return null==e?void 0:null===(n=e.media)||void 0===n?void 0:null===(t=n.title)||void 0===t?void 0:t.userPreferred}).reverse(),t=v()(t,e=>null==e?void 0:e.score).reverse(),e.entries=t,e}),[u]),p=(0,i.useCallback)(e=>{let t=structuredClone(null==b?void 0:b.find(t=>(null==t?void 0:t.status)===e));if(t)return t.entries=anilist_filterEntriesByTitle(t.entries,f),t},[b,f]),N=(0,i.useMemo)(()=>p("CURRENT"),[f,p,u]),T=(0,i.useMemo)(()=>p("PLANNING"),[f,p,u]),P=(0,i.useMemo)(()=>p("PAUSED"),[f,p,u]),E=(0,i.useMemo)(()=>p("COMPLETED"),[f,p,u]),C=(0,i.useMemo)(()=>p("DROPPED"),[f,p,u]);return(0,r.jsxs)("main",{className:"px-4 relative",children:[(0,r.jsx)(SearchInput,{}),(0,r.jsxs)(a.nP,{navClassName:"border-none",tabClassName:(0,s.cn)("text-lg rounded-none border-b border-b-2 border-b-transparent data-[selected=true]:text-white data-[selected=true]:border-brand-400","hover:bg-transparent dark:hover:bg-transparent hover:text-white","dark:border-transparent dark:hover:border-b-transparent dark:data-[selected=true]:border-brand-400 dark:data-[selected=true]:text-white","hover:bg-[--highlight]"),selectedIndex:e,onIndexChange:e=>{l(()=>{t(e)})},children:[(0,r.jsxs)(a.nP.Nav,{children:[(0,r.jsx)(a.nP.Tab,{children:"Currently Watching"}),(0,r.jsx)(a.nP.Tab,{children:"Planning"}),(0,r.jsx)(a.nP.Tab,{children:"Paused"}),(0,r.jsx)(a.nP.Tab,{children:"Completed"}),(0,r.jsx)(a.nP.Tab,{children:"Dropped"})]}),(0,r.jsxs)(a.nP.Container,{className:"pt-8 relative",children:[(0,r.jsx)(d.fz,{className:(0,s.cn)("z-50 backdrop-blur-none",{hidden:!n})}),(0,r.jsx)(a.nP.Panel,{children:(0,r.jsx)(y,{list:N})}),(0,r.jsx)(a.nP.Panel,{children:(0,r.jsx)(y,{list:T})}),(0,r.jsx)(a.nP.Panel,{children:(0,r.jsx)(y,{list:P})}),(0,r.jsx)(a.nP.Panel,{children:(0,r.jsx)(y,{list:E})}),(0,r.jsx)(a.nP.Panel,{children:(0,r.jsx)(y,{list:C})})]})]})]})}let y=i.memo(e=>{var t,n;let{list:i}=e;return(0,r.jsx)("div",{className:"px-4 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-7 min-[2000px]:grid-cols-8 gap-4",children:null==i?void 0:null===(n=i.entries)||void 0===n?void 0:null===(t=n.filter(Boolean))||void 0===t?void 0:t.map(e=>{var t;return(0,r.jsx)(u.k,{listData:{progress:e.progress,score:e.score,status:e.status},showLibraryBadge:!0,media:e.media},"".concat(null===(t=e.media)||void 0===t?void 0:t.id))})})}),SearchInput=()=>{let[e,t]=(0,o.KO)(x),[n,a]=(0,i.useState)(e);return(0,r.jsx)("div",{className:"px-4 mb-8",children:(0,r.jsx)(f.o,{leftIcon:(0,r.jsx)(b.j,{}),value:n,onChange:e=>{a(e.target.value),(0,i.startTransition)(()=>{t(e.target.value)})}})})}},67998:function(e,t,n){"use strict";n.d(t,{DN:function(){return a},SN:function(){return useWebsocketMessageListener},oJ:function(){return s}});var r=n(2265),i=n(77665);let a=(0,r.createContext)(null),s=(0,i.cn)(null);function useWebsocketMessageListener(e){let{type:t,onMessage:n}=e,i=(0,r.useContext)(a);return(0,r.useEffect)(()=>{if(i){let messageHandler=e=>{try{let r=JSON.parse(e.data);r.type&&r.type===t&&n(r.payload)}catch(e){}};return i.addEventListener("message",messageHandler),()=>{i.removeEventListener("message",messageHandler)}}},[i,n]),null}},76732:function(e,t,n){"use strict";n.d(t,{ks:function(){return d},nP:function(){return g}});var r=n(57437),i=n(2265),a=n(54487),s=n(96061),l=n(61396),o=n.n(l);let u=(0,a.xH)({nav:(0,s.j)(["UI-NavigationTabs__nav","flex w-full overflow-hidden overflow-x-auto"]),tab:(0,s.j)(["UI-NavigationTabs__tab","group/navtabs inline-flex flex-none shrink-0 basis-auto items-center py-4 px-2 font-normal text-sm transition outline-none px-4 min-w-0 justify-center relative","focus-visible:bg-[--highlight]","text-[--muted]","hover:text-[--text-color] hover:bg-[--highlight] rounded-md","data-[selected=true]:border-[--brand] data-[selected=true]:font-semibold data-[selected=true]:text-white"]),icon:(0,s.j)(["UI-NavigationTabs__icon","-ml-0.5 mr-2 h-5 w-5"])}),d=i.forwardRef((e,t)=>{let{children:n,className:i,navClassName:s,tabClassName:l,iconClassName:d,items:c,...m}=e;return(0,r.jsx)("nav",{ref:t,className:(0,a.cn)(u.nav(),s,i),...m,children:c.map(e=>{var t;return(0,r.jsxs)(o(),{href:null!==(t=e.href)&&void 0!==t?t:"#",className:(0,a.cn)(u.tab(),l),"aria-current":e.isCurrent?"page":void 0,"data-selected":e.isCurrent,children:[e.icon&&(0,r.jsx)(e.icon,{className:(0,a.cn)(u.icon(),d),"aria-hidden":"true","data-selected":e.isCurrent}),(0,r.jsx)("span",{children:e.name}),e.addon]},e.name)})})});d.displayName="NavigationTabs";var c=n(82817);let m=(0,a.xH)({panels:(0,s.j)(["UI-TabPanels__panels"])}),v=(0,a.xH)({nav:(0,s.j)(["UI-TabNav__nav","isolate flex border-b"])}),f=(0,a.xH)({tab:(0,s.j)(["UI-Tab__tab","relative min-w-0 flex-1 overflow-hidden py-4 px-4 text-sm font-medium text-center focus:z-10","flex items-center justify-center gap-2 border-b-2 -mb-px","text-[--muted] data-[selected=true]:text-[--brand] data-[selected=true]:border-brand dark:data-[selected=true]:border-brand-200","border-[--border] hover:border-gray-300 dark:hover:border-gray-600","focus-visible:bg-[--highlight] outline-none","cursor-pointer"])}),_TabPanels=e=>{let{children:t,panelsClassName:n,navClassName:s,tabClassName:l,className:o,selectedIndex:u,onIndexChange:d,ref:v,...f}=e,b=i.Children.map(t,e=>i.isValidElement(e)&&"TabNav"===(0,a.C2)(e)?i.cloneElement(e,{tabClassName:l,navClassName:s}):e);return(0,r.jsx)(c.O.Group,{selectedIndex:u,onChange:d,children:(0,r.jsx)("div",{className:(0,a.cn)(m.panels(),n),...f,ref:v,children:b})})};_TabPanels.displayName="TabPanels";let b=i.forwardRef((e,t)=>{let{children:n,className:s,navClassName:l,tabClassName:o,...u}=e,d=i.Children.map(n,e=>i.isValidElement(e)&&"Tab"===(0,a.C2)(e)?i.cloneElement(e,{tabClassName:o}):e);return(0,r.jsx)(c.O.List,{className:(0,a.cn)(v.nav(),l,s),...u,ref:t,children:d})});b.displayName="TabNav";let h=i.forwardRef((e,t)=>{let{children:n,className:s,tabClassName:l,...o}=e;return(0,r.jsx)(c.O,{as:i.Fragment,children:e=>{let{selected:i}=e;return(0,r.jsx)("div",{className:(0,a.cn)(f.tab(),l,s),...o,ref:t,"data-selected":i,children:n})}})});h.displayName="Tab",_TabPanels.Tab=h,_TabPanels.Nav=b,_TabPanels.Container=i.memo(c.O.Panels),c.O.Panels,_TabPanels.Panel=c.O.Panel,c.O.Panel,_TabPanels.Container.displayName="TabContainer",_TabPanels.Panel.displayName="TabPanel";let g=(0,a.Fm)(_TabPanels)},34654:function(e,t,n){"use strict";n.d(t,{E:function(){return useDebounceWithSet},N:function(){return useDebounce}});var r=n(2265);function useDebounce(e,t){let[n,i]=(0,r.useState)(e);return(0,r.useEffect)(()=>{let n=setTimeout(()=>i(e),t||500);return()=>{clearTimeout(n)}},[e,t]),n}function useDebounceWithSet(e,t){let[n,i]=(0,r.useState)(e);return(0,r.useEffect)(()=>{let n=setTimeout(()=>i(e),t||500);return()=>{clearTimeout(n)}},[e,t]),[n,i]}},68260:function(e,t,n){"use strict";n.d(t,{Jg:function(){return useMediaDetails},Pe:function(){return useManuallyMatchLocalFiles},Tc:function(){return useAnilistCollectionListener},X7:function(){return useMediaEntry},bo:function(){return useFetchMediaEntrySuggestions},du:function(){return useRefreshAnilistCollection},uJ:function(){return useAnilistCollection}});var r=n(51472),i=n(57638),a=n(38038),s=n(5925),l=n(67998);function useAnilistCollectionListener(){let e=(0,a.NL)();(0,l.SN)({type:i.f.REFRESHED_ANILIST_COLLECTION,onMessage:t=>{(async()=>{await e.refetchQueries({queryKey:["get-library-collection"]}),await e.refetchQueries({queryKey:["get-anilist-collection"]}),await e.refetchQueries({queryKey:["get-missing-episodes"]})})()}})}function useMediaEntry(e){let t="string"==typeof e?Number(e):e,{data:n,isLoading:a}=(0,r.tZ)({endpoint:i.E.MEDIA_ENTRY.replace("{id}",String(t)),queryKey:["get-media-entry",t],enabled:!!t});return{mediaEntry:n,mediaEntryLoading:a}}function useAnilistCollection(){var e,t;let{data:n,isLoading:a}=(0,r.tZ)({endpoint:i.E.ANILIST_COLLECTION,queryKey:["get-anilist-collection"]});return{anilistLists:null!==(t=null==n?void 0:null===(e=n.MediaListCollection)||void 0===e?void 0:e.lists)&&void 0!==t?t:[],isLoading:a}}function useRefreshAnilistCollection(){let e=(0,a.NL)(),{mutate:t,isPending:n}=(0,r.$U)({endpoint:i.E.ANILIST_COLLECTION,mutationKey:["refresh-anilist-collection"],onSuccess:async()=>{s.ZP.success("AniList is up-to-date"),await e.refetchQueries({queryKey:["get-library-collection"]}),await e.refetchQueries({queryKey:["get-anilist-collection"]}),await e.refetchQueries({queryKey:["get-missing-episodes"]})}});return{refreshAnilistCollection:t,isPending:n}}function useMediaDetails(e){let t="string"==typeof e?Number(e):e,{data:n,isLoading:a}=(0,r.tZ)({endpoint:i.E.ANILIST_MEDIA_DETAILS.replace("{id}",String(t)),queryKey:["get-anilist-media-details",t],enabled:!!t});return{mediaDetails:n,mediaDetailsLoading:a}}function useFetchMediaEntrySuggestions(){let{mutate:e,data:t,isPending:n,reset:a}=(0,r.$U)({endpoint:i.E.MEDIA_ENTRY_SUGGESTIONS,mutationKey:["media-entry-suggestions"]});return{fetchSuggestions:t=>e({dir:t}),suggestions:null!=t?t:[],isPending:n,resetSuggestions:a}}function useManuallyMatchLocalFiles(){let e=(0,a.NL)(),{mutate:t,isPending:n}=(0,r.$U)({endpoint:i.E.MEDIA_ENTRY_MANUAL_MATCH,mutationKey:["media-entry-manual-match"],onSuccess:async()=>{await e.refetchQueries({queryKey:["get-library-collection"]})}});return{manuallyMatchEntry:(n,r)=>{t(n,{onSuccess:async()=>{n.mediaId&&await e.refetchQueries({queryKey:["get-media-entry",n.mediaId]}),r()}})},isPending:n}}}},function(e){e.O(0,[492,890,999,685,702,17,898,265,726,669,697,235,912,430,345,832,214,971,472,744],function(){return e(e.s=14398)}),_N_E=e.O()}]);