(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[811],{79261:function(e,t,i){Promise.resolve().then(i.bind(i,25760))},25760:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return Page}});var l=i(57437),n=i(24033),a=i(2265),o=i(68260),s=i(37684),r=i(16691),d=i.n(r);function EntryHeaderBackground(e){var t,i,n,a,o,r,c;let{entry:u}=e;return(0,l.jsx)("div",{className:"__header h-[30rem] ",children:(0,l.jsxs)("div",{className:"h-[35rem] w-full md:w-[calc(100%-5rem)] flex-none object-cover object-center absolute top-0 overflow-hidden",children:[(0,l.jsx)("div",{className:"w-full absolute z-[2] top-0 h-[15rem] bg-gradient-to-b from-[--background-color] to-transparent via"}),(!!(null===(t=u.media)||void 0===t?void 0:t.bannerImage)||!!(null===(n=u.media)||void 0===n?void 0:null===(i=n.coverImage)||void 0===i?void 0:i.extraLarge))&&(0,l.jsx)(d(),{src:(null===(a=u.media)||void 0===a?void 0:a.bannerImage)||(null===(r=u.media)||void 0===r?void 0:null===(o=r.coverImage)||void 0===o?void 0:o.extraLarge)||"",alt:"banner image",fill:!0,quality:100,priority:!0,sizes:"100vw",className:"object-cover object-center z-[1]"}),(null===(c=u.media)||void 0===c?void 0:c.bannerImage)&&(0,l.jsx)(s.O,{className:"z-0 h-full absolute w-full"}),(0,l.jsx)("div",{className:"w-full z-[2] absolute bottom-0 h-[20rem] bg-gradient-to-t from-[--background-color] via-[--background-color] via-opacity-50 via-10% to-transparent"})]})})}var c=i(1022),u=i(42475),m=i(37376),g=i(18743),p=i(9805),v=i(54487),x=i(96061);let h=(0,v.xH)({container:(0,x.j)(["UI-Accordion__container","space-y-2"]),trigger:(0,x.j)(["UI-Accordion__trigger","bg-gray-50 dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700","flex w-full justify-between rounded-lg px-4 py-3 text-left font-medium transition","focus:outline-none focus-visible:ring-2 focus-visible:ring-[--ring] ring-offset-1"]),panel:(0,x.j)(["UI-Accordion__panel","py-2"]),item:(0,x.j)(["UI-Accordion__item"])}),_Accordion=e=>{let{children:t,triggerClassName:i,containerClassName:n,panelClassName:o,itemClassName:s,className:r,...d}=e,c=a.Children.map(t,e=>a.isValidElement(e)?a.cloneElement(e,{triggerClassName:i,panelClassName:o,itemClassName:s}):e);return(0,l.jsx)("div",{className:(0,v.cn)(h.container(),n,r),children:c})},AccordionItem=e=>{let{children:t,title:i,triggerClassName:n,panelClassName:a,itemClassName:o,className:s,defaultOpen:r,...d}=e;return(0,l.jsx)(g.p,{defaultOpen:r,children:e=>{let{open:r}=e;return(0,l.jsxs)("div",{className:(0,v.cn)(h.item(),o,s),...d,children:[(0,l.jsxs)(g.p.Button,{className:(0,v.cn)(h.trigger(),n),children:[i,(0,l.jsx)("svg",{className:(0,v.cn)("ml-1.5 h-5 w-5 flex-shrink-0 transition duration-300",{"-rotate-180":r}),xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 9l-7 7-7-7"})})]}),(0,l.jsx)(p.u,{show:r,enter:"transition duration-300 ease-out",enterFrom:"transform h-0 opacity-0",enterTo:"transform h-full opacity-100",leave:"transition duration-75 ease-out",leaveFrom:"transform h-full opacity-100",leaveTo:"transform h-0 opacity-0",children:(0,l.jsx)(g.p.Panel,{static:!0,className:(0,v.cn)(h.panel(),a),children:t})})]})}})};AccordionItem.displayName="AccordionItem",_Accordion.Item=AccordionItem;let f=(0,v.Fm)(_Accordion);f.displayName="Accordion";var j=i(61396),b=i.n(j),y=i(45652),w=i.n(y),N=i(35073),C=i(76352),S=i(71151),I=i(73514),D=i(67701);function ScoreProgressBadges(e){let{score:t,progress:i,episodes:n}=e;return(0,l.jsxs)(l.Fragment,{children:[!!t&&(0,l.jsx)(m.C,{leftIcon:(0,l.jsx)(D.s,{}),size:"xl",intent:"primary-solid",className:t?t<5?"bg-red-500":t<7?"bg-orange-500":t<9?"bg-green-500":"bg-brand-500 text-white":"",children:t}),(0,l.jsx)(m.C,{size:"xl",className:"!text-lg font-bold !text-yellow-50",children:"".concat(null!=i?i:0,"/").concat(n||"-")})]})}var k=i(5790),E=i(23130),_=i(34813),F=i(97622),T=i(8538),M=i(88356),P=i(23890),z=i(33538),A=i(77665),L=i(7951),R=i(59346),B=i(99374);let EpisodeListItem=e=>{var t,i;let{children:n,action:a,image:o,onClick:s,episodeTitle:r,description:c,title:u,fileName:m,isSelected:g,media:p,isWatched:x,unoptimizedImage:h,isInvalid:f,imageClassName:j,imageContainerClassName:b,className:y,...w}=e;return(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)("div",{className:(0,v.cn)("border border-[--border] p-3 pr-12 rounded-lg relative transition hover:bg-gray-900 group/episode-list-item",{"border-brand-200 bg-gray-800 hover:bg-gray-800":g,"border-red-700":f},y),...w,children:[(0,l.jsxs)("div",{className:(0,v.cn)("flex gap-4 relative",{"cursor-pointer":!!s}),onClick:s,children:[(o||(null===(t=p.coverImage)||void 0===t?void 0:t.medium))&&(0,l.jsx)("div",{className:(0,v.cn)("h-24 w-24 flex-none rounded-md object-cover object-center relative overflow-hidden",b),children:(0,l.jsx)(d(),{src:o||(null===(i=p.coverImage)||void 0===i?void 0:i.medium)||"",alt:"episode image",fill:!0,quality:60,placeholder:(0,R.t)(700,475),sizes:"10rem",className:(0,v.cn)("object-cover object-center transition",{"opacity-30 group-hover/episode-list-item:opacity-100":x},j),"data-src":o})}),o&&h&&(0,l.jsx)("div",{className:"h-24 w-24 flex-none rounded-md object-cover object-center relative overflow-hidden",children:(0,l.jsx)("img",{src:o,alt:"episode image",className:"object-cover object-center absolute w-full h-full","data-src":o})}),(0,l.jsxs)("div",{className:"relative overflow-hidden",children:[f&&(0,l.jsxs)("p",{className:"flex gap-2 text-red-300 items-center",children:[(0,l.jsx)(B.C,{className:"text-lg text-red-500"})," Unidentified"]}),(0,l.jsx)("h4",{className:(0,v.cn)("font-medium transition line-clamp-2",{"opacity-50 group-hover/episode-list-item:opacity-100":x}),children:u}),!!r&&(0,l.jsx)("p",{className:(0,v.cn)("text-sm text-[--muted] line-clamp-2"),children:r}),!!m&&(0,l.jsx)("p",{className:"text-sm text-gray-600 truncate text-ellipsis",children:m}),!!c&&(0,l.jsx)("p",{className:"text-sm text-gray-500 line-clamp-2",children:c}),n&&n]})]}),a&&(0,l.jsx)("div",{className:"absolute right-1 top-1 flex flex-col items-center",children:a})]})})};var U=i(51472),O=i(57638),V=i(34654),G=i(3216),H=i(90466),K=i(30054),W=i(31466);let Z=(0,v.xH)({root:(0,x.j)(["UI-Pagination__root","flex gap-1 text-xs font-medium"]),item:(0,x.j)(["UI-Pagination__item","bg-transparent dark:bg-transparent text-base inline-flex h-8 w-8 items-center justify-center rounded border border-[--border] cursor-pointer","hover:bg-[--highlight] dark:hover:bg-[--highlight] hover:border-[--highlight] select-none","data-[selected=true]:bg-brand-500 data-[selected=true]:border-transparent data-[selected=true]:text-white data-[selected=true]:hover:bg-brand-500 data-[selected=true]:pointer-events-none","data-[disabled=true]:opacity-50 data-[disabled=true]:pointer-events-none data-[disabled=true]:cursor-not-allowed","outline-none ring-[--ring] focus-visible:ring-2"]),ellipsis:(0,x.j)(["UI-Pagination__ellipsis","flex p-2 items-center text-[1.05rem]"])}),_Pagination=e=>{let{children:t,rootClassName:i,itemClassName:n,className:o,ref:s,...r}=e,d=a.useMemo(()=>a.Children.map(t,e=>a.isValidElement(e)&&"PaginationItem"===(0,v.C2)(e)?a.cloneElement(e,{itemClassName:n}):e),[t]);return(0,l.jsx)("ul",{className:(0,v.cn)(Z.root(),i,o),role:"list",...r,ref:s,children:d})};_Pagination.displayName="Pagination";let q=a.forwardRef((e,t)=>{let{value:i,className:n,itemClassName:a,ellipsisClassName:o,...s}=e;return(0,l.jsx)("li",{children:(0,l.jsx)("button",{className:(0,v.cn)(Z.item(),a,n),...s,ref:t,children:i})})});q.displayName="PaginationItem";let Y=a.forwardRef((e,t)=>{let{isChevrons:i=!1,isDisabled:n=!1,direction:a,className:o,itemClassName:s,ellipsisClassName:r,...d}=e;return(0,l.jsx)("li",{children:(0,l.jsx)("button",{className:(0,v.cn)(Z.item(),s,o),"data-disabled":"".concat(n),...d,ref:t,children:"left"===a?(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"h-4 w-4",children:i?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("polyline",{points:"11 17 6 12 11 7"}),(0,l.jsx)("polyline",{points:"18 17 13 12 18 7"})]}):(0,l.jsx)("polyline",{points:"15 18 9 12 15 6"})}):(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"h-4 w-4",children:i?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("polyline",{points:"13 17 18 12 13 7"}),(0,l.jsx)("polyline",{points:"6 17 11 12 6 7"})]}):(0,l.jsx)("polyline",{points:"9 18 15 12 9 6"})})})})});Y.displayName="PaginationTrigger";let $=a.forwardRef((e,t)=>{let{className:i,ellipsisClassName:n,itemClassName:a,...o}=e;return(0,l.jsx)("li",{className:(0,v.cn)(Z.ellipsis(),n,i),children:(0,l.jsx)("span",{...o,ref:t,children:"â€¦"})})});$.displayName="PaginationEllipsis",_Pagination.Item=q,_Pagination.Ellipsis=$,_Pagination.Trigger=Y;let X=(0,v.Fm)(_Pagination);X.displayName="Pagination";var Q=i(53677),J=i(65871),ee=i(69802),et=i(10387),ei=i(52770),el=JSON.parse('{"filters":{"fr":"Filtres","en":"Filters"},"no-matching-result":{"fr":"Aucun r\xe9sultat ne correspond aux filtres","en":"No results matching filters"},"remove-filters":{"fr":"Retirer les filtres","en":"Remove all filters"},"page":{"fr":"Page","en":"Page"},"rows-selected":{"fr":"lignes s\xe9lectionn\xe9es","en":"rows selected"},"row-selected":{"fr":"ligne s\xe9lectionn\xe9e","en":"row selected"},"save":{"fr":"Enregistrer","en":"Save"},"cancel":{"fr":"Annuler","en":"Cancel"},"updating":{"fr":"Modification","en":"Updating"},"true":{"fr":"Vrai","en":"True"},"false":{"fr":"Faux","en":"False"}}');let en=(0,v.xH)({root:(0,x.j)(["UI-DataGridFilter__root","flex gap-2 items-center"])});function DataGridFilter(e){var t,i,n;let{locale:o}=(0,v.k9)(),{children:s,rootClassName:r,className:d,column:c,onRemove:u,...m}=e,g=getColumnHelperMeta(c,"filteringMeta"),p=(0,a.useMemo)(()=>c.getFilterValue(),[c.getFilterValue()]),x=(0,a.useMemo)(()=>c.setFilterValue,[c.setFilterValue]),h=g.icon,f=g.valueFormatter||getValueFormatter(c),j=null!==(n=g.options)&&void 0!==n?n:[],b=(0,a.useCallback)(e=>{x(e)},[]);return(0,l.jsxs)("div",{className:(0,v.cn)(en.root(),r,d),...m,children:["select"===g.type&&(!j||0===j.length)&&(0,l.jsx)("div",{className:"text-red-500",children:'/!\\ "Select" filtering option passed without options'}),"select"===g.type&&!!j&&j.length>0&&(0,l.jsx)(K.P,{leftIcon:h||(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"w-4 h-4",children:(0,l.jsx)("polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"})}),leftAddon:g.name,options:[...j.map(e=>({value:e.value,label:f(e.value)}))],onChange:e=>b(e.target.value.trim().toLowerCase()),size:"sm",fieldClassName:"w-fit",className:"sm:w-auto pr-8 md:max-w-sm"}),"boolean"===g.type&&(0,l.jsx)(Q.h_,{dropdownClassName:"right-[inherit] left",trigger:(0,l.jsx)(ea,{options:g,value:f(p)}),children:(0,l.jsxs)(Q.h_.Group,{children:[(0,l.jsx)(Q.h_.Item,{onClick:()=>b(!0),children:"boolean"==typeof f(!0)?el.true[o]:f(!0)}),(0,l.jsx)(Q.h_.Item,{onClick:()=>b(!1),children:"boolean"==typeof f(!1)?el.false[o]:f(!1)})]})}),"checkbox"===g.type&&!!j.length&&(0,l.jsx)(Q.h_,{dropdownClassName:"right-[inherit] left",trigger:(0,l.jsx)(ea,{options:g,value:Array.isArray(p)?p.map(e=>f(e)):f(p)}),children:(0,l.jsx)(Q.h_.Group,{className:"p-1",children:(null===(t=g.options)||void 0===t?void 0:t.length)&&(0,l.jsx)(J.cO,{options:g.options,value:p,onChange:b,checkboxContainerClassName:"flex flex-row-reverse w-full justify-between",checkboxLabelClassName:"cursor-pointer"})})}),"radio"===g.type&&!!j.length&&(0,l.jsx)(Q.h_,{dropdownClassName:"right-[inherit] left",trigger:(0,l.jsx)(ea,{options:g,value:Array.isArray(p)?p.map(e=>f(e)):f(p)}),children:(0,l.jsx)(Q.h_.Group,{className:"p-1",children:(null===(i=g.options)||void 0===i?void 0:i.length)&&(0,l.jsx)(ee.E,{options:g.options,value:p,onChange:b,radioContainerClassName:"flex flex-row-reverse w-full justify-between",radioLabelClassName:"cursor-pointer"})})}),"date-range"===g.type&&(0,l.jsxs)("div",{className:(0,v.cn)(ej.filterDropdownButton(),"truncate overflow-ellipsis"),children:[g.icon&&(0,l.jsx)("span",{children:g.icon}),(0,l.jsxs)("span",{children:[g.name,":"]}),(0,l.jsx)(ei.Dw,{value:p?{start:(0,et.Aj)(p.start.toISOString()),end:(0,et.Aj)(p.end.toISOString())}:void 0,onChange:e=>b({start:null==e?void 0:e.start.toDate((0,et.iT)()),end:null==e?void 0:e.end.toDate((0,et.iT)())}),intent:"unstyled",locale:o,hideTimeZone:!0,granularity:"day"})]}),(0,l.jsx)(F.PZ,{onClick:u,size:"sm"})]})}(0,v.xH)({root:(0,x.j)(["UI-DataGridActiveFilter__root","py-1 px-2 rounded-[--radius] border border-[--border] flex gap-2 items-center"])}),DataGridFilter.displayName="DataGridFilter";let ea=a.forwardRef((e,t)=>{let{children:i,options:n,value:a,...o}=e,s=Array.isArray(a)?a.length>2?[...a.slice(0,2),"..."].join(", "):a.join(", "):String(a);return(0,l.jsxs)("button",{className:(0,v.cn)(ej.filterDropdownButton(),"truncate overflow-ellipsis"),...o,ref:t,children:[n.icon&&(0,l.jsx)("span",{children:n.icon}),(0,l.jsxs)("span",{children:[n.name,":"]}),(0,l.jsx)("span",{className:"font-semibold flex flex-none overflow-hidden whitespace-normal",children:s})]})});ea.displayName="DataGridActiveFilter";var eo=i(6469);function withEditing(e){return{editingMeta:{...e}}}function withFiltering(e){return{filteringMeta:{...e}}}let getFilterFn=e=>({select:"equalsString",boolean:"equals",checkbox:"arrIncludesSome",radio:"equalsString","date-range":"dateRangeFilter"})[e];function withValueFormatter(e){return{valueFormatter:e}}function getValueFormatter(e){var t;return(null===(t=e.columnDef.meta)||void 0===t?void 0:t.valueFormatter)||(e=>e)}function createDataGridColumns(e){return e({withFiltering,getFilterFn,withEditing,withValueFormatter})}function getColumnHelperMeta(e,t){var i;return null===(i=e.columnDef.meta)||void 0===i?void 0:i[t]}var es=i(11257),er=i(69956);function useDataGridFiltering(e){let{table:t,columnFilters:i}=e,[l,n]=(0,a.useMemo)(()=>[t.getAllLeafColumns().filter(e=>e.getCanFilter()&&!!getColumnHelperMeta(e,"filteringMeta")),t.getAllLeafColumns().filter(e=>i.map(e=>e.id).includes(e.id))],[t.getAllLeafColumns(),i]),o=l.filter(e=>!i.map(e=>e.id).includes(e.id)),s=a.useCallback(e=>{let t=getColumnHelperMeta(e,"filteringMeta");if(t){var i,l,n,a,o;if("select"===t.type||"radio"===t.type)return null!==(n=null===(l=t.options)||void 0===l?void 0:null===(i=l[0])||void 0===i?void 0:i.value)&&void 0!==n?n:"";if("boolean"===t.type)return!0;if("checkbox"===t.type)return null!==(o=null===(a=t.options)||void 0===a?void 0:a.map(e=>e.value))&&void 0!==o?o:[];if("date-range"===t.type)return{start:new Date,end:(0,es.Z)(new Date,7)}}return null},[]);return{getFilterDefaultValue:s,unselectedFilterableColumns:o,filteredColumns:n,filterableColumns:l}}let dateRangeFilter=(e,t,i)=>{let l=e.getValue(t);return l>=i.start&&l<=i.end||(0,er.Z)(l,i.start)||(0,er.Z)(l,i.end)};function useDataGridSize(){let[e,t]=(0,a.useState)(null),[i,l]=(0,a.useState)({width:0,height:0}),n=(0,a.useCallback)(()=>{l({width:(null==e?void 0:e.offsetWidth)||0,height:(null==e?void 0:e.offsetHeight)||0})},[null==e?void 0:e.offsetHeight,null==e?void 0:e.offsetWidth]);return(0,v.OR)("resize",n),(0,v.LI)(()=>{n()},[null==e?void 0:e.offsetHeight,null==e?void 0:e.offsetWidth]),[t,i]}function useDataGridResponsiveness(e){let{hideColumns:t=[],table:i}=e,[l,{width:n}]=useDataGridSize();return a.useLayoutEffect(()=>{t.map(e=>{let{below:t,hide:l}=e;i.getAllLeafColumns().map(e=>{l.includes(e.id)&&(0!==n&&n<t?e.getIsVisible()&&e.toggleVisibility(!1):e.getIsVisible()||e.toggleVisibility(!0))})})},[t,n]),{tableRef:l,tableWidth:n}}var ed=i(53010),ec=i.n(ed);function useDataGridRowSelection(e){let{table:t,data:i,onRowSelect:l,persistent:n,rowSelectionPrimaryKey:o,displayedRows:s,enabled:r}=e,d=(0,a.useRef)(r),c=(0,a.useMemo)(()=>t.getState().pagination.pageIndex,[t.getState().pagination.pageIndex]),u=(0,a.useMemo)(()=>t.getState().pagination.pageSize,[t.getState().pagination.pageSize]),m=(0,a.useMemo)(()=>t.getState().globalFilter,[t.getState().globalFilter]),g=(0,a.useMemo)(()=>t.getState().globalFilter,[t.getState().columnFilters]),p=(0,a.useMemo)(()=>t.getState().sorting,[t.getState().sorting]),v=(0,a.useRef)(s),x=(0,a.useRef)({data:[]}),[h,f]=(0,a.useState)([]),j=(0,a.useMemo)(()=>t.getState().rowSelection,[t.getState().rowSelection]),b=(0,a.useMemo)(()=>t.getRowModel().rows,[t.getRowModel().rows]);(0,a.useEffect)(()=>{r&&!o&&(console.error("[DataGrid] You've enable row selection without providing a primary key. Make sure to define the `rowSelectionPrimaryKey` prop."),d.current=!1)},[]);let y=(0,a.useRef)(!1);return(0,a.useEffect)(()=>{r&&o&&!y.current&&s.length>0&&!s.some(e=>!!e.original[o])&&(console.error("[DataGrid] The key provided by `rowSelectionPrimaryKey` does not match any property in the data."),y.current=!0,d.current=!1)},[s]),(0,a.useLayoutEffect)(()=>{s.length>0&&n&&o&&d.current&&((0,a.startTransition)(()=>{t.resetRowSelection(),f(e=>{let t=v.current.filter(e=>Object.keys(j).map(e=>parseInt(e)).includes(e.index)).filter(t=>!e.find(e=>e.id===t.original[o]));return t.length>0?[...e,...t.map(e=>({id:e.original[o],row:e}))]:e}),v.current=s}),(0,a.startTransition)(()=>{s.map(e=>{h.some(t=>t.id===e.original[o])&&e.getCanSelect()&&!e.getIsSelected()&&(e.toggleSelected(!0),f(t=>[...t.filter(t=>t.id!==e.original[o])]))})}))},[c,u,s,m,g,p]),(0,a.useEffect)(()=>{if(!n&&i&&(null==i?void 0:i.length)>0&&d.current){let t=Object.keys(j).map(e=>parseInt(e));if(t.length>0){var e;l&&l({data:null!==(e=i.filter((e,i)=>t.includes(i)))&&void 0!==e?e:[]})}}},[j,b]),(0,a.useEffect)(()=>{if(n&&i&&(null==i?void 0:i.length)>0&&d.current&&o){let e=new Set(Object.keys(j).map(e=>parseInt(e)));(0,a.startTransition)(()=>{let t={data:[...i.filter((t,i)=>e.has(i)),...h.map(e=>e.row.original)]};isArrayEqual(t.data,x.current.data)||(l&&l(t),x.current=t)})}},[j,x.current]),{selectedRowCount:n?+Object.keys(j).length+h.length:Object.keys(j).length}}let isArrayEqual=function(e,t){return ec()(e,t)};var eu=i(86679),em=i(42077),eg=i.n(em),ep=i(67066),ev=i.n(ep);function useDataGridEditing(e){let{data:t,table:i,rows:l,onRowEdit:n,isDataMutating:o,onDataChange:s,enableOptimisticUpdates:r,optimisticUpdatePrimaryKey:d,manualPagination:c,schema:u,onRowValidationError:m}=e,g=(0,eu.pm)(),p=i.getAllLeafColumns(),[v,x]=(0,a.useState)([]),[h,f]=(0,a.useState)(void 0),[j,b]=(0,a.useState)(void 0),[y,w]=(0,a.useState)(void 0),[N,C]=(0,a.useState)([]),S=(0,a.useMemo)(()=>p.filter(e=>{var t;return e.getIsVisible()&&!!(null===(t=e.columnDef.meta)||void 0===t?void 0:t.editingMeta)}),[p]);(0,a.useEffect)(()=>{c&&(f(void 0),b(void 0),w(void 0),x([]))},[i.getState().pagination.pageIndex,i.getState().pagination.pageSize]);let I=(0,a.useMemo)(()=>l.length>0?ev()(l.map(e=>e.getVisibleCells().filter(e=>{var t;return!!(null===(t=S.find(t=>t.id===e.column.id))||void 0===t?void 0:t.id)}))):[],[l]);(0,a.useLayoutEffect)(()=>{I.length>0&&I.map(e=>{x(t=>[...t,{id:e.id,colId:e.column.id,rowId:e.row.id,isEditing:!1}])})},[I]);let D=(0,a.useCallback)(e=>{x(t=>{let i=t.filter(t=>t.id!==e),l=t.find(t=>t.id===e);if(l&&t.every(e=>!e.isEditing))return[...i,{...l,id:e,isEditing:!0}];if(l&&t.some(e=>e.isEditing)){let n=t.find(e=>e.isEditing);if((null==n?void 0:n.rowId)===(null==l?void 0:l.rowId))return[...i,{...l,id:e,isEditing:!0}]}return t})},[]),k=(0,a.useCallback)(e=>v.some(t=>t.id===e&&t.isEditing),[v]),E=(0,a.useCallback)(e=>!!v.find(t=>t.id===e),[v]),_=(0,a.useCallback)(()=>v.some(e=>e.isEditing),[v]),F=(0,a.useCallback)(()=>v.find(e=>e.isEditing),[v]),T=(0,a.useCallback)(()=>{x(e=>e.map(e=>({...e,isEditing:!1})))},[]),M=a.useRef(!1);(0,a.useEffect)(()=>{void 0!==o&&!o&&M.current&&(T(),M.current=!1)},[o]),(0,a.useEffect)(()=>{void 0===o&&T()},[M.current]);let P=(0,a.useCallback)(e=>{y&&j&&(0,a.startTransition)(()=>{if(eg()(j,y.original))T();else{if(n&&n({originalData:y.original,data:e||j,row:y}),r&&d){let e=structuredClone(t),i=e.findIndex(e=>!!e[d]&&!!j[d]&&e[d]===j[d]);e[i]&&i>-1?(e[i]=j,s(e)):console.error("[DataGrid] Could not perform optimistic update. Make sure `optimisticUpdatePrimaryKey` is a valid property.")}else r&&console.error("[DataGrid] Could not perform optimistic update. Make sure `optimisticUpdatePrimaryKey` is defined.");r?T():M.current=!0}})},[y,j]),z=(0,a.useCallback)(async()=>{if(y&&j){if(C([]),u)try{let e=await u.safeParseAsync(j);if(e.success){let t=structuredClone(j);Object.keys(e.data).map(i=>{t[i]=e.data[i]}),P(t)}else e.error.errors.map(e=>{var t;g.error(null!==(t=e.message)&&void 0!==t?t:"Error"),C(t=>[...t,{rowId:y.id,key:String(e.path[0]),message:e.message}])}),m&&m({data:j,originalData:y.original,row:y,errors:e.error.errors})}catch(e){console.error("[DataGrid] Could not perform validation")}else P()}},[y,j]),A=(0,a.useCallback)((e,t,i,l)=>{f(e),w(t),b(l=>({...(null==y?void 0:y.id)===t.id&&j?j:t.original,[i.column.id]:e}))},[y,j]);return{handleStartEditing:D,getIsCellActivelyEditing:k,getIsCellEditable:E,getIsCurrentlyEditing:_,getFirstCellBeingEdited:F,handleStopEditing:T,handleOnSave:z,handleUpdateValue:A,rowErrors:N}}let ex=(0,v.xH)({root:(0,x.j)(["UI-DataGridCellInputField__root"])});function DataGridCellInputField(e){let{rootClassName:t,cell:i,table:n,row:o,rowErrors:s,onValueUpdated:r,meta:{field:d,zodType:c,valueFormatter:u}}=e,m=null!=u?u:e=>e,g=m(i.getContext().getValue()),p=a.useRef(null),[x,h]=a.useState(g);return a.useLayoutEffect(()=>{var e;r(g,o,i,c),null===(e=p.current)||void 0===e||e.focus()},[]),(0,l.jsx)("div",{className:(0,v.cn)(ex.root(),t),children:d({value:x,onChange:e=>{h(e),r(m(e),o,i,c)},ref:p},{rowErrors:s,table:n,row:o,cell:i})})}DataGridCellInputField.displayName="DataGridCellInputField";var eh=i(7660);function useDataGrid(e){var t,i,n,o,s,r;let d={globalFilter:"",sorting:[],pagination:{pageIndex:0,pageSize:5},rowSelection:{},columnFilters:[],columnVisibility:{}},{data:c,rowCount:u,columns:m,initialState:g,state:p,onRowValidationError:v,validationSchema:x,columnOrder:h,onSortingChange:f,onPaginationChange:j,onRowSelectionChange:b,onGlobalFilterChange:y,onColumnFiltersChange:w,onColumnVisibilityChange:N,enableManualSorting:C=!1,enableManualFiltering:S=!1,enableManualPagination:I=!1,enableRowSelection:D=!1,enablePersistentRowSelection:k=!1,enableOptimisticUpdates:E=!1,enableColumnFilters:_=!0,enableSorting:F=!0,enableFilters:T=!0,enableGlobalFilter:M=!0,filterFns:P,...z}=e,[A,L]=(0,a.useState)(null!=c?c:[]),[R,B]=(0,a.useState)(u);(0,a.useEffect)(()=>{c&&L(c)},[c]),(0,a.useEffect)(()=>{u&&B(u)},[u]);let[U,O]=(0,a.useState)(null!==(t=null==g?void 0:g.globalFilter)&&void 0!==t?t:d.globalFilter),[V,H]=(0,a.useState)(null!==(i=null==g?void 0:g.rowSelection)&&void 0!==i?i:d.rowSelection),[K,W]=(0,a.useState)(null!==(n=null==g?void 0:g.sorting)&&void 0!==n?n:d.sorting),[Z,q]=(0,a.useState)(null!==(o=null==g?void 0:g.columnFilters)&&void 0!==o?o:d.columnFilters),[Y,$]=(0,a.useState)(null!==(s=null==g?void 0:g.columnVisibility)&&void 0!==s?s:d.columnVisibility),[X,Q]=(0,a.useState)(null!==(r=null==g?void 0:g.pagination)&&void 0!==r?r:d.pagination),ee=(0,a.useMemo)(()=>{var e;return null!==(e=Math.ceil(R/X.pageSize))&&void 0!==e?e:-1},[R,X.pageSize]),et=(0,a.useMemo)(()=>[{id:"_select",size:0,maxSize:0,enableSorting:!1,disableSortBy:!0,disableGlobalFilter:!0,header:e=>{let{table:t}=e;return(0,l.jsx)(J.XZ,{checked:t.getIsSomeRowsSelected()?"indeterminate":t.getIsAllRowsSelected(),onChange:()=>t.toggleAllRowsSelected()})},cell:e=>{let{row:t}=e;return(0,l.jsx)("div",{className:"px-1",children:(0,l.jsx)(J.XZ,{checked:t.getIsSomeSelected()?"indeterminate":t.getIsSelected(),isDisabled:!t.getCanSelect(),onChange:t.getToggleSelectedHandler()},t.id)})}},...m],[m]),ei=(0,a.useMemo)(()=>{var e;return null!==(e=null==p?void 0:p.sorting)&&void 0!==e?e:K},[null==p?void 0:p.sorting,K]),el=(0,a.useMemo)(()=>{var e;return null!==(e=null==p?void 0:p.pagination)&&void 0!==e?e:X},[null==p?void 0:p.pagination,X]),en=(0,a.useMemo)(()=>{var e;return null!==(e=null==p?void 0:p.rowSelection)&&void 0!==e?e:V},[null==p?void 0:p.rowSelection,V]),ea=(0,a.useMemo)(()=>{var e;return null!==(e=null==p?void 0:p.globalFilter)&&void 0!==e?e:U},[null==p?void 0:p.globalFilter,U]),eo=(0,a.useMemo)(()=>{var e;return null!==(e=null==p?void 0:p.columnFilters)&&void 0!==e?e:Z},[null==p?void 0:p.columnFilters,Z]),es=(0,a.useMemo)(()=>{var e;return null!==(e=null==p?void 0:p.columnVisibility)&&void 0!==e?e:Y},[null==p?void 0:p.columnVisibility,Y]),er=(0,a.useCallback)((e,t)=>i=>{e&&e(i),t&&t(i)},[]),ed=(0,G.b7)({data:A,columns:D?et:m,pageCount:ee,globalFilterFn:(e,t,i)=>{let l=(()=>{let i=e.getValue(t);return"number"==typeof i?String(i):i})();return null==l?void 0:l.trim().toLowerCase().includes(i.trim().toLowerCase())},state:{sorting:ei,pagination:el,rowSelection:en,globalFilter:ea,columnFilters:eo,columnVisibility:es,columnOrder:h},onSortingChange:er(f,W),onPaginationChange:er(j,Q),onRowSelectionChange:er(b,H),onGlobalFilterChange:er(y,O),onColumnFiltersChange:er(w,q),onColumnVisibilityChange:er(N,$),getCoreRowModel:(0,eh.sC)(),getSortedRowModel:C?void 0:(0,eh.tj)(),getFilteredRowModel:S?void 0:(0,eh.vL)(),filterFns:{dateRangeFilter:dateRangeFilter,...P},manualPagination:I,manualSorting:C,manualFiltering:S,enableRowSelection:D,enableSorting:F,enableColumnFilters:_,enableFilters:T,enableGlobalFilter:M}),ec=(0,a.useMemo)(()=>{let e=ed.getState().pagination;return I?ed.getRowModel().rows:ed.getRowModel().rows.slice(e.pageIndex*e.pageSize,(e.pageIndex+1)*e.pageSize)},[ed.getRowModel().rows,ed.getState().pagination]);return(0,a.useLayoutEffect)(()=>{ed.setPageIndex(0)},[ed.getState().globalFilter]),(0,a.useEffect)(()=>{I||B(ed.getRowModel().rows.length)},[ed.getRowModel().rows]),{...z,table:ed,displayedRows:ec,setData:L,data:A,pageCount:ee,rowCount:R,columns:m,sorting:ei,pagination:el,rowSelection:en,globalFilter:ea,columnFilters:eo,columnVisibility:es,enableManualSorting:C,enableManualFiltering:S,enableManualPagination:I,enableRowSelection:D,enablePersistentRowSelection:k,enableOptimisticUpdates:E,enableGlobalFilter:M,validationSchema:x,onRowValidationError:v,handleGlobalFilterChange:null!=y?y:O,handleColumnFiltersChange:null!=w?w:q}}var ef=i(11305);let ej=(0,v.xH)({root:(0,x.j)(["UI-DataGrid__root"]),header:(0,x.j)(["UI-DataGrid__header","block space-y-4 w-full mb-4"]),toolbar:(0,x.j)(["UI-DataGrid__toolbar","flex w-full items-center gap-4 flex-wrap"]),tableWrapper:(0,x.j)(["UI-DataGrid__tableWrapper","flex flex-col"]),tableContainer:(0,x.j)(["UI-DataGrid__tableContainer","align-middle inline-block min-w-full relative"]),table:(0,x.j)(["UI-DataGrid__table","w-full overflow-x-auto relative table-auto md:table-fixed"]),tableHead:(0,x.j)(["UI-DataGrid__tableHead","border-b border-[--border]"]),th:(0,x.j)(["UI-DataGrid__th group/th","px-3 h-12 text-left text-sm font-bold","data-[is-selection-col=true]:px-3 data-[is-selection-col=true]:sm:px-1 data-[is-selection-col=true]:text-center"]),titleChevronContainer:(0,x.j)(["UI-DataGrid__titleChevronContainer","absolute flex items-center inset-y-0 top-1 -right-9 group"]),titleChevron:(0,x.j)(["UI-DataGrid__titleChevron","mr-3 h-4 w-4 text-gray-400 group-hover:text-gray-500 relative bottom-0.5"]),tableBody:(0,x.j)(["UI-DataGrid__tableBody","bg-[--paper] divide-y divide-[--border] w-full relative"]),td:(0,x.j)(["UI-DataGrid__td","px-2 py-2 w-full whitespace-nowrap text-base font-normal text-[--text-color]","data-[is-selection-col=true]:px-2 data-[is-selection-col=true]:sm:px-0 data-[is-selection-col=true]:text-center","data-[action-col=false]:truncate data-[action-col=false]:overflow-ellipsis","data-[row-selected=true]:bg-brand-50 dark:data-[row-selected=true]:bg-gray-700","data-[editing=true]:ring-1 data-[editing=true]:ring-[--ring] ring-inset","data-[editable=true]:hover:bg-[--highlight] md:data-[editable=true]:focus:ring-2 md:data-[editable=true]:focus:ring-[--slate]","focus:outline-none"]),tr:(0,x.j)(["UI-DataGrid__tr","hover:bg-[--highlight] truncate"]),footer:(0,x.j)(["UI-DataGrid__footer","flex flex-col sm:flex-row w-full items-center gap-2 justify-between p-2 mt-2 overflow-x-auto max-w-full"]),footerPageDisplayContainer:(0,x.j)(["UI-DataGrid__footerPageDisplayContainer","flex flex-none items-center gap-1 ml-2 text-sm"]),footerPaginationInputContainer:(0,x.j)(["UI-DataGrid__footerPaginationInputContainer","flex flex-none items-center gap-2"]),filterDropdownButton:(0,x.j)(["UI-DataGrid__filterDropdownButton","flex gap-2 items-center bg-[--paper] border border-[--border] rounded-[--radius] py-1 px-2 cursor-pointer hover:bg-[--highlight]","select-none focus-visible:ring-2 outline-none ring-[--ring]"])});function DataGrid(e){let{locale:t}=(0,v.k9)(),{rootClassName:i,headerClassName:n,toolbarClassName:o,tableWrapperClassName:r,tableContainerClassName:d,tableHeadClassName:c,tableClassName:u,thClassName:m,titleChevronClassName:g,titleChevronContainerClassName:x,tableBodyClassName:h,trClassName:f,tdClassName:j,footerClassName:b,footerPageDisplayContainerClassName:y,footerPaginationInputContainerClassName:w,filterDropdownButtonClassName:N,tableApi:C,globalSearchInputProps:S,hideGlobalSearchInput:I,...D}=e,{table:k,data:E,setData:_,displayedRows:T,globalFilter:M,columnFilters:P,handleGlobalFilterChange:z,handleColumnFiltersChange:A,isLoading:L,isDataMutating:R,hideColumns:B,enablePersistentRowSelection:U,onRowEdit:O,onRowSelect:V,rowSelectionPrimaryKey:H,enableRowSelection:Z,enableOptimisticUpdates:q,optimisticUpdatePrimaryKey:Y,enableManualPagination:$,enableGlobalFilter:J,validationSchema:ee,onRowValidationError:et}=null!=C?C:useDataGrid({...D}),ei=L||!q&&R,{tableRef:en}=useDataGridResponsiveness({table:k,hideColumns:B}),{selectedRowCount:ea}=useDataGridRowSelection({table:k,data:E,displayedRows:T,persistent:U,onRowSelect:V,rowSelectionPrimaryKey:H,enabled:Z}),{getFilterDefaultValue:es,unselectedFilterableColumns:er,filteredColumns:ed,filterableColumns:ec}=useDataGridFiltering({table:k,columnFilters:P}),{handleStartEditing:eu,getIsCellActivelyEditing:em,getIsCellEditable:eg,getIsCurrentlyEditing:ep,getFirstCellBeingEdited:ev,handleStopEditing:ex,handleOnSave:eh,handleUpdateValue:eb,rowErrors:ey}=useDataGridEditing({table:k,data:E,rows:T,onRowEdit:O,isDataMutating:R,enableOptimisticUpdates:q,optimisticUpdatePrimaryKey:Y,manualPagination:$,onDataChange:_,schema:ee,onRowValidationError:et});return(0,l.jsxs)("div",{className:(0,v.cn)(ej.root(),i),children:[(0,l.jsxs)("div",{className:(0,v.cn)(ej.header(),n),children:[(0,l.jsxs)("div",{className:(0,v.cn)(ej.toolbar(),o),children:[J&&!I&&(0,l.jsx)(DataGridSearchInput,{value:null!=M?M:"",onChange:e=>z(String(e)),...S}),er.length>0&&(0,l.jsx)(Q.h_,{trigger:(0,l.jsxs)("button",{className:(0,v.cn)(ej.filterDropdownButton(),N),children:[(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"w-4 h-4",children:(0,l.jsx)("polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"})}),(0,l.jsxs)("span",{children:[el.filters[t]," (",er.length,")"]})]}),children:er.map(e=>{var t,i;let n=es(e),a=null===(t=getColumnHelperMeta(e,"filteringMeta"))||void 0===t?void 0:t.icon,o=null===(i=getColumnHelperMeta(e,"filteringMeta"))||void 0===i?void 0:i.name;return(0,l.jsxs)(Q.h_.Item,{onClick:()=>A(t=>[...t,{id:e.id,value:n}]),children:[a&&(0,l.jsx)("span",{className:"text-lg",children:a}),(0,l.jsx)("span",{children:o})]},e.id)})}),er.length!==ec.length&&(0,l.jsx)(eo.u,{trigger:(0,l.jsx)(F.hU,{icon:v.QN.undo(),intent:"gray-outline",size:"sm",onClick:()=>A([])}),children:el["remove-filters"][t]}),ea>0&&(0,l.jsxs)("div",{className:"text-sm",children:[ea," ",el["row".concat(ea>1?"s":"","-selected")][t]]})]}),ed.length>0&&(0,l.jsx)("div",{className:(0,v.cn)(ej.toolbar(),o),children:ed.map(e=>(0,l.jsx)(DataGridFilter,{column:e,onRemove:()=>A(t=>[...t.filter(t=>t.id!==e.id)])},e.id))}),(0,l.jsx)(p.u,{appear:!0,show:ep(),className:"fixed top-2 left-0 right-0 flex justify-center z-20",enter:"transition-all duration-150",enterFrom:"opacity-0 scale-50",enterTo:"opacity-100 scale-100",leave:"transition-all duration-150",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-75",children:(0,l.jsxs)("div",{className:"flex items-center gap-2 rounded-md p-4 bg-[--paper] border border-[--brand] shadow-sm z-20",children:[(0,l.jsx)("span",{className:"font-semibold",children:el.updating[t]}),(0,l.jsx)(F.zx,{size:"sm",onClick:eh,isDisabled:R,children:el.save[t]}),(0,l.jsx)(F.zx,{size:"sm",onClick:ex,intent:"gray-outline",isDisabled:R,children:el.cancel[t]})]})})]}),(0,l.jsx)("div",{className:(0,v.cn)(ej.tableWrapper(),r),ref:en,children:(0,l.jsx)("div",{className:"relative",children:(0,l.jsxs)("div",{className:(0,v.cn)(ej.tableContainer(),d),children:[(0,l.jsxs)("table",{className:(0,v.cn)(ej.table(),u),children:[(0,l.jsx)("thead",{className:(0,v.cn)(ej.tableHead(),c),children:k.getHeaderGroups().map(e=>(0,l.jsx)("tr",{children:e.headers.map((e,t)=>(0,l.jsx)("th",{colSpan:e.colSpan,scope:"col",className:(0,v.cn)(ej.th(),m),"data-is-selection-col":"".concat(0===t&&Z),style:{width:e.getSize()},children:0!==t&&Z||!Z?(0,l.jsx)("div",{className:(0,v.cn)("flex items-center justify-between",{"cursor-pointer":e.column.getCanSort()}),children:e.isPlaceholder?null:(0,l.jsxs)("div",{className:"flex relative items-center",onClick:e.column.getToggleSortingHandler(),children:[(0,G.ie)(e.column.columnDef.header,e.getContext()),(0,l.jsxs)("span",{className:(0,v.cn)(ej.titleChevronContainer(),x),children:["asc"===e.column.getIsSorted()&&(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:(0,v.cn)(ej.titleChevron(),g),children:(0,l.jsx)("polyline",{points:"18 15 12 9 6 15"})}),"desc"===e.column.getIsSorted()&&(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:(0,v.cn)(ej.titleChevron(),g),children:(0,l.jsx)("polyline",{points:"6 9 12 15 18 9"})}),!1===e.column.getIsSorted()&&e.column.getCanSort()&&(0,l.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:(0,v.cn)(ej.titleChevron(),"w-4 h-4 opacity-0 transition-opacity group-hover/th:opacity-100",g),children:[(0,l.jsx)("path",{d:"m7 15 5 5 5-5"}),(0,l.jsx)("path",{d:"m7 9 5-5 5 5"})]})]})]})}):(0,G.ie)(e.column.columnDef.header,e.getContext())},e.id))},e.id))}),(0,l.jsx)("tbody",{className:(0,v.cn)(ej.tableBody(),h),children:T.map(e=>(0,l.jsx)("tr",{className:(0,v.cn)(ej.tr(),f),children:e.getVisibleCells().map((e,t)=>{var i,n;let o=eg(e.id)&&!em(e.id)&&(!ep()||(null===(i=ev())||void 0===i?void 0:i.rowId)===e.row.id);return(0,l.jsxs)("td",{className:(0,v.cn)(ej.td(),j),"data-is-selection-col":"".concat(0===t&&Z),"data-action-col":"".concat("_actions"===e.column.id),"data-row-selected":e.getContext().row.getIsSelected(),"data-editing":em(e.id),"data-editable":o,"data-row-editing":(null===(n=ev())||void 0===n?void 0:n.rowId)===e.row.id,style:{width:e.column.getSize(),maxWidth:e.column.columnDef.maxSize},onDoubleClick:()=>(0,a.startTransition)(()=>{eu(e.id)}),onKeyUp:t=>{"Enter"===t.key&&(0,a.startTransition)(()=>eu(e.id))},tabIndex:o?0:void 0,children:[(!eg(e.id)||!em(e.id))&&(0,G.ie)(e.column.columnDef.cell,{...e.getContext(),renderValue:()=>getValueFormatter(e.column)(e.getContext().getValue())}),em(e.id)&&(0,l.jsx)(DataGridCellInputField,{cell:e,row:e.row,table:k,rowErrors:ey,meta:getColumnHelperMeta(e.column,"editingMeta"),onValueUpdated:eb})]},e.id)})},e.id))})]}),ei&&T.length>0&&(0,l.jsx)(ef.fz,{className:"backdrop-blur-[1px] bg-opacity-40 pt-0"}),ei&&0===T.length&&[...[,,,,,].keys()].map((e,t)=>(0,l.jsx)(s.O,{className:"rounded-none h-12"},t)),0===T.length&&!ei&&0===ed.length&&(0,l.jsx)("p",{className:"flex w-full justify-center py-4",children:(0,l.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",viewBox:"0 0 48 48",children:[(0,l.jsx)("path",{fill:"#D1C4E9",d:"M38 7H10c-1.1 0-2 .9-2 2v6c0 1.1.9 2 2 2h28c1.1 0 2-.9 2-2V9c0-1.1-.9-2-2-2zm0 12H10c-1.1 0-2 .9-2 2v6c0 1.1.9 2 2 2h28c1.1 0 2-.9 2-2v-6c0-1.1-.9-2-2-2zm0 12H10c-1.1 0-2 .9-2 2v6c0 1.1.9 2 2 2h28c1.1 0 2-.9 2-2v-6c0-1.1-.9-2-2-2z"}),(0,l.jsx)("circle",{cx:"38",cy:"38",r:"10",fill:"#F44336"}),(0,l.jsxs)("g",{fill:"#fff",children:[(0,l.jsx)("path",{d:"m43.31 41.181l-2.12 2.122l-8.485-8.484l2.121-2.122z"}),(0,l.jsx)("path",{d:"m34.819 43.31l-2.122-2.12l8.484-8.485l2.122 2.121z"})]})]})}),0===T.length&&!ei&&ed.length>0&&(0,l.jsxs)("div",{className:"w-full text-center py-4",children:[(0,l.jsx)("p",{className:"flex w-full justify-center mb-4",children:(0,l.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",viewBox:"0 0 48 48",children:[(0,l.jsx)("path",{fill:"#D1C4E9",d:"M38 7H10c-1.1 0-2 .9-2 2v6c0 1.1.9 2 2 2h28c1.1 0 2-.9 2-2V9c0-1.1-.9-2-2-2zm0 12H10c-1.1 0-2 .9-2 2v6c0 1.1.9 2 2 2h28c1.1 0 2-.9 2-2v-6c0-1.1-.9-2-2-2zm0 12H10c-1.1 0-2 .9-2 2v6c0 1.1.9 2 2 2h28c1.1 0 2-.9 2-2v-6c0-1.1-.9-2-2-2z"}),(0,l.jsx)("circle",{cx:"38",cy:"38",r:"10",fill:"#F44336"}),(0,l.jsxs)("g",{fill:"#fff",children:[(0,l.jsx)("path",{d:"m43.31 41.181l-2.12 2.122l-8.485-8.484l2.121-2.122z"}),(0,l.jsx)("path",{d:"m34.819 43.31l-2.122-2.12l8.484-8.485l2.122 2.121z"})]})]})}),(0,l.jsx)("p",{children:el["no-matching-result"][t]})]})]})})}),(0,l.jsxs)("div",{className:(0,v.cn)(ej.footer(),b),children:[(0,l.jsxs)(X,{children:[(0,l.jsx)(X.Trigger,{direction:"left",isChevrons:!0,onClick:()=>k.setPageIndex(0),isDisabled:!k.getCanPreviousPage()||ei}),(0,l.jsx)(X.Trigger,{direction:"left",onClick:()=>k.previousPage(),isDisabled:!k.getCanPreviousPage()||ei}),(0,l.jsx)(X.Trigger,{direction:"right",onClick:()=>k.nextPage(),isDisabled:!k.getCanNextPage()||ei}),(0,l.jsx)(X.Trigger,{direction:"right",isChevrons:!0,onClick:()=>k.setPageIndex(k.getPageCount()-1),isDisabled:!k.getCanNextPage()||ei})]}),(0,l.jsx)("div",{className:(0,v.cn)(ej.footerPageDisplayContainer(),y),children:k.getPageCount()>0&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{children:el.page[t]}),(0,l.jsxs)("strong",{children:[k.getState().pagination.pageIndex+1," / ",k.getPageCount()]})]})}),(0,l.jsxs)("div",{className:(0,v.cn)(ej.footerPaginationInputContainer(),w),children:[E.length>0&&(0,l.jsx)(W.Y,{discrete:!0,value:k.getState().pagination.pageIndex+1,min:1,onChange:e=>{let t=e?e-1:0;(0,a.startTransition)(()=>{e<=k.getPageCount()&&k.setPageIndex(t)})},className:"inline-flex flex-none items-center w-[3rem]",size:"sm"}),(0,l.jsx)(K.P,{value:k.getState().pagination.pageSize,onChange:e=>{k.setPageSize(Number(e.target.value))},options:[Number(k.getState().pagination.pageSize),...[5,10,20,30,40,50].filter(e=>e!==Number(k.getState().pagination.pageSize))].map(e=>({value:e,label:"".concat(e)})),fieldClassName:"w-auto",className:"w-auto pr-8",isDisabled:ei,size:"sm"})]})]})]})}function DataGridSearchInput(e){let{value:t,onChange:i,debounce:n=500,...o}=e,[s,r]=(0,a.useState)(t);return(0,a.useEffect)(()=>{r(t)},[t]),(0,a.useEffect)(()=>{let e=setTimeout(()=>{i(s)},n);return()=>clearTimeout(e)},[s]),(0,l.jsx)(H.o,{size:"md",fieldClassName:"md:max-w-[30rem]",...o,value:s,onChange:e=>r(e.target.value),leftIcon:(0,l.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"w-5 h-5 text-[--muted]",children:[(0,l.jsx)("circle",{cx:"11",cy:"11",r:"8"}),(0,l.jsx)("path",{d:"m21 21-4.3-4.3"})]})})}DataGrid.displayName="DataGrid";var eb=i(66834);let ey=(0,a.memo)(e=>{let{isSelected:t,isInvalid:i,className:n,onClick:a,releaseGroup:o,isBatch:s,title:r,filename:d,children:c,action:u,image:m}=e;return(0,l.jsxs)("div",{className:(0,v.cn)("border border-[--border] p-3 pr-12 rounded-lg relative transition hover:bg-gray-900 group/episode-list-item",{"border-brand-200 bg-gray-800 hover:bg-gray-800":t,"hover:border-gray-500":!t,"border-red-700":i},n),children:[(0,l.jsxs)("div",{className:(0,v.cn)("flex gap-4 relative",{"cursor-pointer":!!a}),onClick:a,children:[(0,l.jsxs)("div",{className:(0,v.cn)("h-24 w-24 flex-none rounded-md object-cover object-center relative overflow-hidden","flex items-center justify-center bg-gray-800","text-xs px-2"),children:[(0,l.jsx)("p",{className:(0,v.cn)("z-[1] font-bold line-clamp-1",{"text-brand-200":"subsplease"===o.toLowerCase()}),children:o}),!!m&&(0,l.jsx)("img",{src:m,alt:"episode image",className:"object-cover object-center absolute w-full h-full blur-xs opacity-20 z-[0] select-none pointer-events-none","data-src":m}),s&&(0,l.jsx)(eb.T,{className:"text-7xl absolute opacity-20"})]}),(0,l.jsxs)("div",{className:"relative overflow-hidden",children:[i&&(0,l.jsxs)("p",{className:"flex gap-2 text-red-300 items-center",children:[(0,l.jsx)(B.C,{className:"text-lg text-red-500"})," Unidentified"]}),(0,l.jsx)("h4",{className:(0,v.cn)("font-medium transition line-clamp-2"),children:s?"Batch":r}),!!d&&(0,l.jsx)("p",{className:(0,v.cn)("text-sm text-gray-400 line-clamp-2 mb-2"),children:d}),(0,l.jsx)("div",{className:"flex items-center gap-2",children:c&&c})]})]}),u&&(0,l.jsx)("div",{className:"absolute right-1 top-1 flex flex-col items-center",children:u})]})});function TorrentResolutionBadge(e){let{resolution:t}=e;return t?(0,l.jsx)(m.C,{intent:(null==t?void 0:t.includes("1080"))?"warning":(null==t?void 0:t.includes("2160"))||(null==t?void 0:t.toLowerCase().includes("4k"))?"success":"gray",children:t}):(0,l.jsx)(m.C,{intent:"gray",children:"Unknown"})}function TorrentSeedersBadge(e){let{seeders:t}=e;return(0,l.jsxs)(m.C,{intent:parseInt(t)>20?parseInt(t)>200?"primary":"success":"gray",children:[(0,l.jsx)("span",{className:"text-sm",children:t})," seeders"]})}var ew=i(36255),eN=i(33591);let eC=(0,a.memo)(e=>{let{previews:t,isLoading:i,selectedTorrents:n,onToggleTorrent:a}=e;return i?(0,l.jsx)(ef.TK,{}):(0,l.jsx)("div",{className:"space-y-2",children:t.filter(Boolean).map(e=>{var t,i,o;return(0,l.jsxs)(ey,{title:(null===(t=e.episode)||void 0===t?void 0:t.displayTitle)||"",releaseGroup:e.releaseGroup,filename:e.torrent.name,isBatch:e.isBatch,image:null===(o=e.episode)||void 0===o?void 0:null===(i=o.episodeMetadata)||void 0===i?void 0:i.image,isSelected:-1!==n.findIndex(t=>t.guid===e.torrent.guid),onClick:()=>a(e.torrent),action:(0,l.jsx)(eo.u,{trigger:(0,l.jsx)(F.hU,{icon:(0,l.jsx)(ew.r,{}),intent:"primary-basic",size:"sm",onClick:()=>window.open(e.torrent.guid,"_blank")}),children:"View on NYAA"}),children:[(0,l.jsx)(TorrentResolutionBadge,{resolution:e.resolution}),(0,l.jsx)(TorrentSeedersBadge,{seeders:e.torrent.seeders}),(0,l.jsxs)("p",{className:"text-gray-300 text-sm flex items-center gap-1",children:[(0,l.jsx)(eN.U,{})," ",e.torrent.size]}),(0,l.jsxs)("p",{className:"text-[--muted] text-sm flex items-center gap-1",children:["- ",(0,l.jsx)(c.V,{})," ",(0,k.Z)(new Date(e.torrent.date),{addSuffix:!0})]})]},e.torrent.guid)})})});var eS=i(60691);let eI=(0,a.memo)(e=>{var t;let{torrents:i,selectedTorrents:n,globalFilter:o,setGlobalFilter:s,quickSearch:r,isFetching:d,isLoading:c,onToggleTorrent:u}=e,m=(0,a.useMemo)(()=>createDataGridColumns(()=>[{accessorKey:"name",header:"Name",cell:e=>(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(eo.u,{trigger:(0,l.jsx)(F.hU,{icon:(0,l.jsx)(ew.r,{}),intent:"primary-basic",size:"sm",onClick:()=>window.open(e.row.original.guid,"_blank")}),children:"View on NYAA"}),(0,l.jsx)(eo.u,{trigger:(0,l.jsx)("div",{className:(0,v.cn)("text-[.95rem] truncate text-ellipsis cursor-pointer max-w-[90%] overflow-hidden",{"text-brand-300 font-semibold":n.some(t=>t.guid===e.row.original.guid)}),onClick:()=>u(e.row.original),children:e.getValue()}),children:e.getValue()})]}),size:80},{accessorKey:"resolution",header:"Resolution",cell:e=>(0,l.jsx)(TorrentResolutionBadge,{resolution:e.getValue()}),size:2},{accessorKey:"seeders",header:"Seeders",cell:e=>(0,l.jsx)(TorrentSeedersBadge,{seeders:e.getValue()}),size:20},{accessorKey:"date",header:"Date",cell:e=>(0,k.Z)(new Date(e.getValue()),{addSuffix:!0}),size:10}]),[i,n]);return(0,l.jsx)(DataGrid,{columns:m,data:null==i?void 0:i.slice(0,20),rowCount:null!==(t=null==i?void 0:i.length)&&void 0!==t?t:0,initialState:{pagination:{pageSize:20,pageIndex:0}},tdClassName:"py-4 data-[row-selected=true]:bg-gray-900",tableBodyClassName:"bg-transparent",footerClassName:"hidden",state:{globalFilter:o},enableManualFiltering:!0,onGlobalFilterChange:s,isLoading:c||d,isDataMutating:d,hideGlobalSearchInput:r})});var eD=i(19395),ek=i(46076),eE=i(3493),e_=i(392),eF=i(751),eT=i(86321),eM=i(5925);let eP=(0,A.cn)(!1);function TorrentConfirmationModal(e){var t,i,o,s,r;let{onToggleTorrent:d,media:c,entry:u}=e,m=(0,n.useRouter)(),g=(0,P.Dv)(eF.X),p=null==g?void 0:null===(i=g.settings)||void 0===i?void 0:null===(t=i.library)||void 0===t?void 0:t.libraryPath,v=(0,a.useMemo)(()=>{var e,t,i;let l=null===(t=u.localFiles)||void 0===t?void 0:null===(e=t.findLast(e=>e))||void 0===e?void 0:e.path,n=p?e_.join(p,sanitizeDirectoryName((null===(i=c.title)||void 0===i?void 0:i.romaji)||"")):"";return l?e_.normalize(e_.dirname(l)):n},[p,u.localFiles,null===(o=c.title)||void 0===o?void 0:o.romaji]),[x,h]=(0,a.useState)(v),[f,j]=(0,P.KO)(eP),b=(0,P.Dv)(ez),y=(0,a.useMemo)(()=>{var e,t,i,l;return 1===b.length&&b[0].isBatch&&"MOVIE"!==c.format&&"FINISHED"===c.status&&!!c.episodes&&c.episodes>1&&!!(null===(e=u.downloadInfo)||void 0===e?void 0:e.episodesToDownload)&&(null===(t=u.downloadInfo)||void 0===t?void 0:t.episodesToDownload.length)>0&&(null===(i=u.downloadInfo)||void 0===i?void 0:i.episodesToDownload.length)!==(c.episodes||(null===(l=c.nextAiringEpisode)||void 0===l?void 0:l.episode)-1)},[b,c.format,c.status,c.episodes,null===(s=u.downloadInfo)||void 0===s?void 0:s.episodesToDownload,null===(r=c.nextAiringEpisode)||void 0===r?void 0:r.episode]),{mutate:w,data:N,isPending:C}=(0,U.$U)({endpoint:O.E.DOWNLOAD,method:"post",mutationKey:["download-torrent"],onSuccess:()=>{eM.ZP.success("Download started"),j(!1),m.push("/torrent-list")}});function handleLaunchDownload(e){if(!p||!x.toLowerCase().startsWith(p.slice(0,-1).toLowerCase())){eM.ZP.error("Destination folder does not match local library");return}if(e){var t,i,l;w({urls:b.map(e=>e.guid),destination:x,smartSelect:{enabled:!0,missingEpisodeNumbers:(null===(i=u.downloadInfo)||void 0===i?void 0:null===(t=i.episodesToDownload)||void 0===t?void 0:t.map(e=>e.episodeNumber))||[],absoluteOffset:(null===(l=u.downloadInfo)||void 0===l?void 0:l.absoluteOffset)||0},media:c})}else w({urls:b.map(e=>e.guid),destination:x,smartSelect:{enabled:!1,missingEpisodeNumbers:[],absoluteOffset:0},media:c})}return 0===b.length?null:(0,l.jsxs)(z.u_,{isOpen:f,onClose:()=>j(!1),size:"2xl",isClosable:!0,title:"Choose the destination",children:[(0,l.jsx)("div",{className:"pb-4",children:(0,l.jsx)(eE.k,{name:"destination",label:"Destination",leftIcon:(0,l.jsx)(eb.T,{}),defaultValue:x,onSelect:h,shouldExist:!1})}),(0,l.jsxs)("div",{className:"space-y-2",children:[b.map(e=>(0,l.jsx)(eo.u,{trigger:(0,l.jsxs)("div",{className:"ml-12 gap-2 p-2 border border-[--border] rounded-md hover:bg-gray-800 relative",children:[(0,l.jsxs)("div",{className:"flex flex-none items-center gap-2 w-[90%] cursor-pointer",onClick:()=>window.open(e.guid,"_blank"),children:[(0,l.jsxs)("span",{className:"text-lg",children:[e.isBatch&&"MOVIE"!==c.format?(0,l.jsx)(eb.T,{className:"text-2xl"}):(0,l.jsx)(eD.$,{})," "]}),(0,l.jsx)("p",{className:"truncate text-ellipsis",children:e.name})]}),(0,l.jsx)(F.hU,{icon:(0,l.jsx)(ek.c,{}),className:"absolute right-2 top-2 rounded-full",size:"xs",intent:"gray-outline",onClick:()=>{d(e)}})]},e.name),children:"Open on NYAA"},"".concat(e.guid))),(0,l.jsxs)("div",{className:"mt-4 flex w-full justify-end gap-2",children:[b.length>0&&y&&(0,l.jsx)(F.zx,{leftIcon:(0,l.jsx)(eT.m,{}),intent:"white-outline",onClick:()=>handleLaunchDownload(!0),isLoading:C,children:"Download missing only"}),b.length>0&&(0,l.jsx)(F.zx,{leftIcon:(0,l.jsx)(T.y,{}),intent:"white",onClick:()=>handleLaunchDownload(!1),isLoading:C,children:y?"Download all":"Download"})]})]})]})}function TorrentConfirmationContinueButton(){let e=(0,P.Dv)(ez),t=(0,P.b9)(eP);return 0===e.length?null:(0,l.jsxs)(F.zx,{intent:"primary",className:"animate-pulse",onClick:()=>t(!0),children:["Continue (",e.length,")"]})}function sanitizeDirectoryName(e){let t=e.replace(/[<>:"/\\|?*\x00-\x1F]/g," "),i=t.trim().replace(/^\.+|\.+$/g,"").replace(/\s+/g," ");return i||"Untitled"}let ez=(0,A.cn)([]);function TorrentSearchContainer(e){var t,i,n,o,s,r,d,c;let{entry:u}=e,m=u.downloadInfo,g=!!(null==m?void 0:null===(t=m.episodesToDownload)||void 0===t?void 0:t.length),[p,x]=(0,P.KO)(eL),[h,f]=(0,a.useState)(g?"":(null===(n=u.media)||void 0===n?void 0:null===(i=n.title)||void 0===i?void 0:i.romaji)||""),[j,b]=(0,P.KO)(ez),[y,w]=(0,a.useState)(g),[N,C]=(0,a.useState)((null==m?void 0:m.canBatch)||!1),[S,I]=(0,a.useState)((null==m?void 0:null===(r=m.episodesToDownload)||void 0===r?void 0:null===(s=r[0])||void 0===s?void 0:null===(o=s.episode)||void 0===o?void 0:o.episodeNumber)||1),[D,k]=(0,a.useState)(""),[E,_]=(0,V.E)(S,500);(0,a.useLayoutEffect)(()=>{void 0!==p&&(I(p),_(p),(0,a.startTransition)(()=>{x(void 0)}))},[p]),(0,a.useEffect)(()=>{b([])},[]),(0,a.useLayoutEffect)(()=>{if(y)f("");else{var e,t;f((null===(t=u.media)||void 0===t?void 0:null===(e=t.title)||void 0===e?void 0:e.romaji)||"")}},[y]);let{data:F,isLoading:T,isFetching:M}=(0,U.tZ)({endpoint:O.E.NYAA_SEARCH,queryKey:["nyaa-search",u.mediaId,E,h,N,D,y,null==m?void 0:m.absoluteOffset],queryFn:async()=>(0,U.E6)({endpoint:O.E.NYAA_SEARCH,method:"post",data:{query:h,episodeNumber:E,batch:N,media:u.media,absoluteOffset:(null==m?void 0:m.absoluteOffset)||0,resolution:D,quickSearch:y}}),refetchOnWindowFocus:!1,retry:0,retryDelay:1e3,enabled:!(void 0===S&&0===h.length)}),z=(0,a.useMemo)(()=>{var e;return null!==(e=null==F?void 0:F.torrents)&&void 0!==e?e:[]},[null==F?void 0:F.torrents]),A=(0,a.useMemo)(()=>{var e;return null!==(e=null==F?void 0:F.previews)&&void 0!==e?e:[]},[null==F?void 0:F.previews]),L=(0,a.useCallback)(()=>(0,l.jsx)(W.Y,{label:"Episode number",value:S,onChange:e=>{(0,a.startTransition)(()=>{I(e)})},discrete:!0,size:"sm",fieldClassName:(0,v.cn)("flex items-center justify-end gap-3 space-y-0",{"opacity-50 cursor-not-allowed pointer-events-none":N||!y}),fieldLabelClassName:"flex-none self-center font-normal !text-md sm:text-md lg:text-md",inputClassName:"max-w-[6rem]"}),[y,N,m,p]),R=(0,a.useCallback)(e=>{b(t=>{let i=t.findIndex(t=>t.guid===e.guid);return -1!==i?t.filter(t=>t.guid!==e.guid):[...t,e]})},[b]);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"pb-4 flex w-full justify-between",children:[(0,l.jsx)(eS.r,{label:"Smart search",help:"Automatically fetch torrents based on parameters",checked:y,onChange:w}),(0,l.jsx)(TorrentConfirmationContinueButton,{})]}),y&&(0,l.jsx)("div",{children:(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)("div",{className:"flex gap-4 justify-between w-full",children:[(0,l.jsx)(eS.r,{label:"Batches",help:(null==m?void 0:m.canBatch)?void 0:"Cannot look for batches for this media",checked:N,onChange:C,fieldClassName:(0,v.cn)({"opacity-50 cursor-not-allowed pointer-events-none":!(null==m?void 0:m.canBatch)})}),(0,l.jsx)(L,{}),(0,l.jsx)(K.P,{label:"Resolution",value:D,onChange:e=>{var t;return k(null!==(t=e.target.value)&&void 0!==t?t:"")},options:[{value:"",label:"Any"},{value:"1080",label:"1080p"},{value:"720",label:"720p"},{value:"480",label:"480p"}],size:"sm",fieldClassName:(0,v.cn)("flex items-center justify-end gap-3 space-y-0",{"opacity-50 cursor-not-allowed pointer-events-none":!y}),fieldLabelClassName:"flex-none self-center font-normal !text-md sm:text-md lg:text-md",className:"w-[6rem]"})]}),(0,l.jsx)(DataGridSearchInput,{value:null!=h?h:"",onChange:e=>f(e),placeholder:y?"Refine the title (".concat(null===(c=u.media)||void 0===c?void 0:null===(d=c.title)||void 0===d?void 0:d.romaji,")"):"Search",fieldClassName:"md:max-w-full w-full"}),(0,l.jsx)("div",{className:"pb-1"}),(0,l.jsx)(eC,{previews:A,isLoading:T,selectedTorrents:j,onToggleTorrent:R})]})}),(0,l.jsx)(eI,{torrents:z,globalFilter:h,setGlobalFilter:f,quickSearch:y,isLoading:T,isFetching:M,selectedTorrents:j,onToggleTorrent:R})]}),(0,l.jsx)(TorrentConfirmationModal,{onToggleTorrent:R,media:u.media,entry:u})]})}let eA=(0,A.cn)(!1),eL=(0,A.cn)(void 0);function TorrentSearchDrawer(e){var t;let{entry:i}=e,[o,s]=(0,P.KO)(eA),r=(0,n.useSearchParams)(),d=(0,n.useRouter)(),c=(0,n.usePathname)(),u=r.get("id"),m=r.get("download");return(0,a.useEffect)(()=>{m&&(s(!0),d.replace(c+"?id=".concat(u)))},[m]),(0,l.jsxs)(z.dy,{isOpen:o,onClose:()=>s(!1),isClosable:!0,size:"xl",title:"Search torrents",children:[(0,l.jsx)(EpisodeList,{episodes:null===(t=i.downloadInfo)||void 0===t?void 0:t.episodesToDownload}),(0,l.jsx)(TorrentSearchContainer,{entry:i})]})}function EpisodeList(e){let{episodes:t}=e;return t&&t.length?(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("h4",{children:"Missing episodes:"}),(0,l.jsxs)("p",{children:["Episode numbers: ",t.map(e=>e.episodeNumber).join(", ")]}),(0,l.jsx)(L.i,{children:t.filter(Boolean).map(e=>{var t,i,n,a,o,s,r;return(0,l.jsx)(EpisodeListItem,{media:null===(t=e.episode)||void 0===t?void 0:t.basicMedia,title:(null===(i=e.episode)||void 0===i?void 0:i.displayTitle)||"",image:null===(a=e.episode)||void 0===a?void 0:null===(n=a.episodeMetadata)||void 0===n?void 0:n.image,episodeTitle:null==e?void 0:null===(o=e.episode)||void 0===o?void 0:o.episodeTitle,description:(null===(s=e.episode)||void 0===s?void 0:s.absoluteEpisodeNumber)!==e.episodeNumber?"(Episode ".concat(null==e?void 0:null===(r=e.episode)||void 0===r?void 0:r.absoluteEpisodeNumber,")"):void 0,imageContainerClassName:"w-20 h-20",className:"flex-none w-80"},e.episode+e.aniDBEpisode)})})]}),(0,l.jsx)(_.iz,{className:"py-2 mt-4"})]}):null}function MetaSection(e){var t,i,n,a,o,s,r,g,p,v,x,h,j,y,D,k,E,F,T,M,P,z,A,L,R,B,U,O;let{entry:V,details:G}=e,H=((null===(n=V.media)||void 0===n?void 0:null===(i=n.relations)||void 0===i?void 0:null===(t=i.edges)||void 0===t?void 0:t.map(e=>e))||[]).filter(Boolean).filter(e=>{var t,i,l;return((null===(t=e.node)||void 0===t?void 0:t.format)==="TV"||(null===(i=e.node)||void 0===i?void 0:i.format)==="OVA"||(null===(l=e.node)||void 0===l?void 0:l.format)==="MOVIE")&&("PREQUEL"===e.relationType||"SEQUEL"===e.relationType||"PARENT"===e.relationType||"SIDE_STORY"===e.relationType||"ALTERNATIVE"===e.relationType||"ADAPTATION"===e.relationType)}),K=null==G?void 0:null===(a=G.rankings)||void 0===a?void 0:a.find(e=>(!!(null==e?void 0:e.season)||!!(null==e?void 0:e.year))&&(null==e?void 0:e.type)==="POPULAR"&&e.rank<=10),W=null==G?void 0:null===(o=G.rankings)||void 0===o?void 0:o.find(e=>!!(null==e?void 0:e.allTime)&&(null==e?void 0:e.type)==="RATED"&&e.rank<=100),Z=null==G?void 0:null===(s=G.rankings)||void 0===s?void 0:s.find(e=>(!!(null==e?void 0:e.season)||!!(null==e?void 0:e.year))&&(null==e?void 0:e.type)==="RATED"&&e.rank<=5);return(null==G||null===(r=G.rankings)||void 0===r||r.find(e=>!!(null==e?void 0:e.allTime)&&(null==e?void 0:e.type)==="POPULAR"&&e.rank<=100),V.media)?(0,l.jsxs)("div",{className:"space-y-8 pb-10",children:[(0,l.jsx)("div",{className:"space-y-8 p-8 rounded-xl bg-gray-900 bg-opacity-80 drop-shadow-md relative",children:(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("h1",{className:"[text-shadow:_0_1px_10px_rgb(0_0_0_/_20%)]",children:null===(g=V.media.title)||void 0===g?void 0:g.userPreferred}),(null===(v=V.media.title)||void 0===v?void 0:null===(p=v.userPreferred)||void 0===p?void 0:p.toLowerCase())!==(null===(h=V.media.title)||void 0===h?void 0:null===(x=h.english)||void 0===x?void 0:x.toLowerCase())&&(0,l.jsx)("h4",{className:"text-gray-400",children:null===(j=V.media.title)||void 0===j?void 0:j.english})]}),V.media.season?(0,l.jsx)("div",{children:(0,l.jsxs)("p",{className:"text-lg text-gray-200 flex w-full gap-1 items-center",children:[(0,l.jsx)(c.V,{})," ",new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short"}).format(new Date((null===(y=V.media.startDate)||void 0===y?void 0:y.year)||0,(null===(D=V.media.startDate)||void 0===D?void 0:D.month)||0))," - ",w()(null!==(O=V.media.season)&&void 0!==O?O:"")]})}):(0,l.jsx)("p",{className:"text-lg text-gray-200 flex w-full gap-1 items-center"}),(0,l.jsxs)("div",{className:"flex gap-4 items-center",children:[(0,l.jsx)(ScoreProgressBadges,{score:null===(k=V.listData)||void 0===k?void 0:k.score,progress:null===(E=V.listData)||void 0===E?void 0:E.progress,episodes:V.media.episodes}),(0,l.jsx)(u.X,{listData:V.listData,media:V.media}),(0,l.jsx)("p",{className:"text-lg",children:w()((null===(F=V.listData)||void 0===F?void 0:F.status)==="CURRENT"?"Watching":null===(T=V.listData)||void 0===T?void 0:T.status)})]}),(0,l.jsx)("p",{className:"max-h-24 overflow-y-auto",children:null==G?void 0:null===(M=G.description)||void 0===M?void 0:M.replace(/(<([^>]+)>)/ig,"")}),!!(null==G?void 0:null===(P=G.studios)||void 0===P?void 0:P.nodes)&&(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"font-bold",children:"Studio"}),(0,l.jsx)(m.C,{className:"ml-2",size:"lg",intent:"gray",badgeClassName:"rounded-md",children:null==G?void 0:null===(L=G.studios)||void 0===L?void 0:null===(A=L.nodes)||void 0===A?void 0:null===(z=A[0])||void 0===z?void 0:z.name})]}),(0,l.jsxs)("div",{className:"items-center flex flex-wrap gap-2",children:[!!(null==G?void 0:G.meanScore)&&(0,l.jsx)(m.C,{className:"",size:"lg",intent:G.meanScore>=70?G.meanScore>=85?"primary":"success":"warning",leftIcon:(0,l.jsx)(N.k,{}),children:G.meanScore/10}),null==G?void 0:null===(R=G.genres)||void 0===R?void 0:R.map(e=>(0,l.jsx)(m.C,{className:"mr-2",size:"lg",children:e},e))]}),(!!W||!!K)&&(0,l.jsxs)("div",{className:"flex flex-wrap gap-2",children:[W&&(0,l.jsxs)(m.C,{className:"",size:"lg",intent:"gray",leftIcon:(0,l.jsx)(C.p,{}),iconClassName:"text-yellow-500",badgeClassName:"rounded-md",children:["#",String(W.rank)," Highest Rated ","TV"!==W.format?"".concat(W.format):""," of All Time"]}),Z&&(0,l.jsxs)(m.C,{className:"",size:"lg",intent:"gray",leftIcon:(0,l.jsx)(S.y,{}),iconClassName:"text-yellow-500",badgeClassName:"rounded-md",children:["#",String(Z.rank)," Highest Rated ","TV"!==Z.format?"".concat(Z.format):""," of ",w()(Z.season)," ",Z.year]}),K&&(0,l.jsxs)(m.C,{className:"",size:"lg",intent:"gray",leftIcon:(0,l.jsx)(I.l,{}),iconClassName:"text-pink-500",badgeClassName:"rounded-md",children:["#",String(K.rank)," Most Popular ","TV"!==K.format?"".concat(K.format):""," of ",w()(K.season)," ",K.year]})]}),"NOT_YET_RELEASED"!==V.media.status&&(0,l.jsx)(TorrentSearchButton,{entry:V}),(0,l.jsx)(_.iz,{className:"dark:border-gray-800"}),(0,l.jsx)(NextAiringEpisode,{media:V.media}),(0,l.jsx)("div",{className:"w-full flex justify-end",children:(0,l.jsx)(b(),{href:"https://anilist.co/anime/".concat(V.mediaId),target:"_blank",children:"Open on AniList"})})]})}),(0,l.jsxs)(f,{containerClassName:"hidden md:block",triggerClassName:"bg-gray-900 bg-opacity-80 dark:bg-gray-900 dark:bg-opacity-80 hover:bg-gray-800 dark:hover:bg-gray-800 hover:bg-opacity-100 dark:hover:bg-opacity-100",children:[H.length>0&&(0,l.jsx)(f.Item,{title:"Relations",defaultOpen:!0,children:(0,l.jsx)("div",{className:"grid grid-cols-4 gap-4 p-4",children:H.slice(0,4).map(e=>{var t,i,n,a,o,s,r,c;return(0,l.jsx)("div",{className:"col-span-1",children:(0,l.jsx)(b(),{href:"/entry?id=".concat(null===(t=e.node)||void 0===t?void 0:t.id),children:(null===(n=e.node)||void 0===n?void 0:null===(i=n.coverImage)||void 0===i?void 0:i.large)&&(0,l.jsxs)("div",{className:"h-64 w-full flex-none rounded-md object-cover object-center relative overflow-hidden group/anime-list-item",children:[(0,l.jsx)(d(),{src:null===(a=e.node)||void 0===a?void 0:a.coverImage.large,alt:"",fill:!0,quality:80,priority:!0,sizes:"10rem",className:"object-cover object-center group-hover/anime-list-item:scale-110 transition"}),(0,l.jsx)("div",{className:"z-[5] absolute bottom-0 w-full h-[60%] bg-gradient-to-t from-black to-transparent"}),(0,l.jsx)(m.C,{className:"absolute left-2 top-2 font-semibold rounded-md text-[.95rem]",intent:"white-solid",children:(null===(o=e.node)||void 0===o?void 0:o.format)==="MOVIE"?w()(e.relationType||"").replace("_"," ")+" (Movie)":w()(e.relationType||"").replace("_"," ")}),(0,l.jsx)("div",{className:"p-2 z-[5] absolute bottom-0 w-full ",children:(0,l.jsx)("p",{className:"font-semibold line-clamp-2 overflow-hidden",children:null===(r=e.node)||void 0===r?void 0:null===(s=r.title)||void 0===s?void 0:s.userPreferred})})]})})},null===(c=e.node)||void 0===c?void 0:c.id)})})}),(0,l.jsx)(f.Item,{title:"Recommendations",children:(0,l.jsx)("div",{className:"grid grid-cols-4 gap-4 p-4",children:null==G?void 0:null===(U=G.recommendations)||void 0===U?void 0:null===(B=U.edges)||void 0===B?void 0:B.map(e=>{var t;return null==e?void 0:null===(t=e.node)||void 0===t?void 0:t.mediaRecommendation}).filter(Boolean).map(e=>{var t,i;return(0,l.jsx)("div",{className:"col-span-1",children:(0,l.jsx)(b(),{href:"/entry?id=".concat(e.id),children:(null===(t=e.coverImage)||void 0===t?void 0:t.large)&&(0,l.jsxs)("div",{className:"h-64 w-full flex-none rounded-md object-cover object-center relative overflow-hidden group/anime-list-item",children:[(0,l.jsx)(d(),{src:e.coverImage.large,alt:"",fill:!0,quality:80,priority:!0,sizes:"10rem",className:"object-cover object-center group-hover/anime-list-item:scale-110 transition"}),(0,l.jsx)("div",{className:"z-[5] absolute bottom-0 w-full h-[60%] bg-gradient-to-t from-black to-transparent"}),(0,l.jsx)("div",{className:"p-2 z-[5] absolute bottom-0 w-full ",children:(0,l.jsx)("p",{className:"font-semibold line-clamp-2 overflow-hidden",children:null===(i=e.title)||void 0===i?void 0:i.userPreferred})})]})})},e.id)})})})]})]}):null}function TorrentSearchButton(e){var t,i,n,o,s,r,d;let{entry:c}=e,u=(0,P.b9)(eA),m=null===(i=c.downloadInfo)||void 0===i?void 0:null===(t=i.episodesToDownload)||void 0===t?void 0:t.length,g=(0,a.useMemo)(()=>{var e;return(null===(e=c.media)||void 0===e?void 0:e.format)==="MOVIE"},[null===(n=c.media)||void 0===n?void 0:n.format]);return(0,l.jsxs)("div",{children:[(null===(o=c.downloadInfo)||void 0===o?void 0:o.hasInaccurateSchedule)&&(0,l.jsxs)("p",{className:"text-orange-200 text-center mb-3",children:[(0,l.jsx)("span",{className:"block",children:"Could not retrieve accurate scheduling information for this show."}),(0,l.jsx)("span",{className:"block text-[--muted]",children:"Please check the schedule online for more information."})]}),(0,l.jsx)(F.zx,{className:"w-full",intent:(null===(s=c.downloadInfo)||void 0===s?void 0:s.hasInaccurateSchedule)?"warning-subtle":m?"white":"white-subtle",size:"lg",leftIcon:m?(0,l.jsx)(T.y,{}):(0,l.jsx)(M.j,{}),iconClassName:"text-2xl",onClick:()=>u(!0),children:(null===(r=c.downloadInfo)||void 0===r?void 0:r.hasInaccurateSchedule)||!m?(0,l.jsx)(l.Fragment,{children:"Search torrents"}):(0,l.jsxs)(l.Fragment,{children:[!g&&"Download ".concat((null===(d=c.downloadInfo)||void 0===d?void 0:d.batchAll)?"batch /":"next"," ").concat(m>1?"".concat(m," episodes"):"episode"),g&&"Download movie"]})})]})}function NextAiringEpisode(e){var t,i;return(0,l.jsx)(l.Fragment,{children:!!e.media.nextAiringEpisode&&(0,l.jsxs)("div",{className:"flex gap-2 items-center justify-center",children:[(0,l.jsxs)("p",{className:"text-xl min-[2000px]:text-xl",children:["Next episode ",(0,k.Z)((0,E.Z)(new Date,null===(t=e.media.nextAiringEpisode)||void 0===t?void 0:t.timeUntilAiring),{addSuffix:!0}),":"]}),(0,l.jsx)("p",{className:"text-justify font-normal text-xl min-[2000px]:text-xl",children:(0,l.jsx)(m.C,{size:"lg",children:null===(i=e.media.nextAiringEpisode)||void 0===i?void 0:i.episode})})]})})}var eR=i(93054),eB=i(62319),eU=i(37122);function useConfirmationDialog(e){let t=(0,eU.q)(!1);return{...t,...e}}let ConfirmationDialog=e=>{let{isOpen:t,close:i,onConfirm:n,title:a,description:o="Are you sure you want to continue?",actionText:s="Confirm",actionIntent:r="alert-subtle"}=e;return(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(z.u_,{title:a,titleClassName:"text-center",isOpen:t,onClose:i,isClosable:!0,children:(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsx)("p",{className:"text-center",children:o}),(0,l.jsxs)("div",{className:"flex gap-2 justify-center items-center",children:[(0,l.jsx)(F.zx,{intent:r,onClick:()=>{n(),i()},children:s}),(0,l.jsx)(F.zx,{intent:"white",onClick:i,children:"Cancel"})]})]})})})};var eO=i(12325),eV=i(98602),eG=i(10137);function EpisodeSectionMenu(e){let{entry:t}=e,{startDefaultMediaPlayer:i}=(0,eV.VP)(),{openEntryInExplorer:n}=(0,eV.tB)(),{unmatchAll:a,isPending:o}=(0,eG.Kg)(t.mediaId),s=useConfirmationDialog({title:"Unmatch all files",description:"Are you sure you want to unmatch all files?",onConfirm:()=>{a(t.mediaId)}});return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(Q.h_,{trigger:(0,l.jsx)(F.hU,{icon:(0,l.jsx)(eO.T,{}),intent:"gray-basic",size:"xl"}),children:[(0,l.jsx)(Q.h_.Item,{onClick:()=>n(t.mediaId),children:"Open folder"}),(0,l.jsx)(Q.h_.Item,{onClick:i,children:"Start video player"}),(0,l.jsx)(Q.h_.Divider,{}),(0,l.jsx)(Q.h_.Group,{title:"Bulk actions",children:(0,l.jsx)(Q.h_.Item,{className:"text-red-500 dark:text-red-200",onClick:s.open,disabled:o,children:"Unmatch all files"})})]}),(0,l.jsx)(ConfirmationDialog,{...s})]})}var eH=i(24285),eK=i(34479);function BulkToggleLockButton(e){var t,i;let{entry:n}=e,a=null===(t=n.libraryData)||void 0===t?void 0:t.allFilesLocked,{toggleLock:o,isPending:s}=(0,eG.Kg)(n.mediaId);return(0,l.jsx)(eo.u,{trigger:(0,l.jsx)(F.hU,{icon:(null===(i=n.libraryData)||void 0===i?void 0:i.allFilesLocked)?(0,l.jsx)(eK.K,{}):(0,l.jsx)(eH.k,{}),intent:a?"success-subtle":"warning-subtle",size:"xl",className:"hover:opacity-60",onClick:()=>o(n.mediaId),isLoading:s}),children:a?"Unlock all files":"Lock all files"})}var eW=i(33216),eZ=i(32366),eq=i(26345),eY=i(24521);let e$=(0,eW.Xn)(),eX=(0,A.cn)(!1),eQ=(0,A.cn)(!1),eJ=(0,a.memo)(e=>{var t,i,n,a;let{episode:o,media:s,isWatched:r,onPlay:d}=e,{updateLocalFile:c,isPending:u}=(0,eG._U)(s.id);return(0,l.jsxs)(e$.Provider,{children:[(0,l.jsx)(EpisodeListItem,{media:s,image:null===(t=o.episodeMetadata)||void 0===t?void 0:t.image,onClick:()=>{var e,t;return d({path:null!==(t=null===(e=o.localFile)||void 0===e?void 0:e.path)&&void 0!==t?t:""})},isInvalid:o.isInvalid,title:o.displayTitle,episodeTitle:o.episodeTitle,fileName:null===(i=o.localFile)||void 0===i?void 0:i.name,isWatched:o.progressNumber>0&&r,action:(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(F.hU,{icon:(null===(n=o.localFile)||void 0===n?void 0:n.locked)?(0,l.jsx)(eK.K,{}):(0,l.jsx)(eH.k,{}),intent:(null===(a=o.localFile)||void 0===a?void 0:a.locked)?"success-basic":"warning-basic",size:"md",className:"hover:opacity-60",isLoading:u,onClick:()=>{if(o.localFile){var e;c(o.localFile,{locked:!(null===(e=o.localFile)||void 0===e?void 0:e.locked)})}}}),(0,l.jsxs)(Q.h_,{trigger:(0,l.jsx)(F.hU,{icon:(0,l.jsx)(eZ.K,{}),intent:"gray-basic",size:"xs"}),children:[(0,l.jsx)(MetadataModalButton,{}),(0,l.jsx)(Q.h_.Divider,{}),(0,l.jsx)(Q.h_.Item,{className:"!text-red-300 !dark:text-red-200",onClick:()=>{o.localFile&&c(o.localFile,{mediaId:0})},children:"Unmatch"})]}),!!o.episodeMetadata&&("main"===o.type||"special"===o.type)&&(0,l.jsx)(EpisodeItemInfoModalButton,{})]})}),(0,l.jsx)(MetadataModal,{episode:o}),(0,l.jsx)(EpisodeItemInfoModal,{episode:o})]})}),e0=(0,eq.SC)(e=>{let{z:t}=e;return t.object({episode:t.number().min(0),aniDBEpisode:t.string().transform(e=>e.toUpperCase()),type:t.string().min(0)})});function MetadataModal(e){var t,i;let{episode:n}=e,[a,o]=e$.useAtom(eX),{updateLocalFile:s,isPending:r}=(0,eG._U)(null===(t=n.basicMedia)||void 0===t?void 0:t.id);return(0,l.jsxs)(z.u_,{isOpen:a,onClose:()=>o(!1),isClosable:!0,title:n.displayTitle,titleClassName:"text-center",size:"lg",children:[(0,l.jsx)("p",{className:"w-full line-clamp-2 text-sm text-[--muted] px-4 text-center py-2 flex-none",children:null===(i=n.localFile)||void 0===i?void 0:i.name}),(0,l.jsxs)(eq.Fu,{schema:e0,onSubmit:e=>{if(n.localFile){var t;s(n.localFile,{metadata:{...null===(t=n.localFile)||void 0===t?void 0:t.metadata,type:e.type,episode:e.episode,aniDBEpisode:e.aniDBEpisode}},()=>{o(!1),eM.ZP.success("Metadata saved")})}},onError:console.log,defaultValues:{...n.fileMetadata},children:[(0,l.jsx)(eq.gN.Number,{label:"Episode number",name:"episode",help:"Relative episode number. If movie, episode number = 1",discrete:!0,isRequired:!0}),(0,l.jsx)(eq.gN.Text,{label:"AniDB episode",name:"aniDBEpisode",help:"Specials typically contain the letter S"}),(0,l.jsx)(eq.gN.Select,{label:"Type",name:"type",options:[{label:"Main",value:"main"},{label:"Special",value:"special"},{label:"NC/Other",value:"nc"}]}),(0,l.jsx)("div",{className:"w-full flex justify-end",children:(0,l.jsx)(eq.gN.Submit,{role:"save",intent:"success",isLoading:r})})]})]})}function MetadataModalButton(){let[,e]=e$.useAtom(eX);return(0,l.jsx)(Q.h_.Item,{onClick:()=>e(!0),children:"Update metadata"})}function EpisodeItemInfoModalButton(){let[,e]=e$.useAtom(eQ);return(0,l.jsx)(F.hU,{icon:(0,l.jsx)(eY.n,{}),intent:"gray-basic",size:"xs",onClick:()=>e(!0)})}function EpisodeItemInfoModal(e){var t,i,n,a,o,s,r,c;let{episode:u}=e,[m,g]=e$.useAtom(eQ);return(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)(z.u_,{isOpen:m,onClose:()=>g(!1),title:u.displayTitle,isClosable:!0,size:"xl",titleClassName:"text-xl",children:[(null===(t=u.episodeMetadata)||void 0===t?void 0:t.image)&&(0,l.jsxs)("div",{className:"h-[8rem] w-full flex-none object-cover object-center overflow-hidden absolute left-0 top-0 z-[-1]",children:[(0,l.jsx)(d(),{src:null===(i=u.episodeMetadata)||void 0===i?void 0:i.image,alt:"banner",fill:!0,quality:80,priority:!0,sizes:"20rem",className:"object-cover object-center opacity-30"}),(0,l.jsx)("div",{className:"z-[5] absolute bottom-0 w-full h-[80%] bg-gradient-to-t from-gray-900 to-transparent"})]}),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("p",{className:"text-lg line-clamp-2 font-semibold",children:[u.episodeTitle,u.isInvalid&&(0,l.jsx)(B.C,{})]}),(0,l.jsxs)("p",{className:"text-[--muted]",children:[(null===(n=u.episodeMetadata)||void 0===n?void 0:n.airDate)||"Unknown airing date"," - ",(null===(a=u.episodeMetadata)||void 0===a?void 0:a.length)||"N/A"," minutes"]}),(0,l.jsx)("p",{className:"text-[--muted]",children:(null===(o=u.episodeMetadata)||void 0===o?void 0:o.summary)||"No summary"}),!!(null===(s=u.episodeMetadata)||void 0===s?void 0:s.aniDBId)&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(_.iz,{}),(0,l.jsxs)("div",{className:"w-full flex justify-between",children:[(0,l.jsxs)("p",{children:["AniDB Episode: ",null===(r=u.fileMetadata)||void 0===r?void 0:r.aniDBEpisode]}),(0,l.jsx)("a",{href:"https://anidb.net/episode/"+(null===(c=u.episodeMetadata)||void 0===c?void 0:c.aniDBId)+"#layout-footer",target:"_blank",className:"text-brand-200",children:"Open on AniDB"})]})]})]})]})})}var e2=i(20302),e1=i(83891),e4=i(47900);function UndownloadedEpisodeList(e){let{downloadInfo:t,media:i}=e,n=null==t?void 0:t.episodesToDownload,o=(0,P.b9)(eA),s=(0,P.b9)(eL);return(null==n?void 0:n.length)?(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsx)("p",{className:"",children:(null==t?void 0:t.rewatch)?"You have not downloaded the following:":"You have not watched nor downloaded the following:"}),(0,l.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:null==n?void 0:n.sort((e,t)=>e.episodeNumber-t.episodeNumber).map((e,t)=>{var n,r,d,u;if(!e.episode)return null;let m=e.episode;return(0,l.jsx)(EpisodeListItem,{media:i,image:null===(n=m.episodeMetadata)||void 0===n?void 0:n.image,isInvalid:m.isInvalid,title:m.displayTitle,episodeTitle:m.episodeTitle,action:(0,l.jsx)("div",{className:"",children:(0,l.jsx)("a",{onClick:()=>{s(m.episodeNumber),(0,a.startTransition)(()=>{o(!0)})},className:"text-orange-200 absolue top-1 right-1 text-3xl absolute animate-pulse cursor-pointer",children:(0,l.jsx)(T.y,{})})}),children:(0,l.jsx)("div",{className:"mt-1",children:(0,l.jsxs)("p",{className:"flex gap-1 items-center text-sm text-[--muted]",children:[(0,l.jsx)(c.V,{})," ",(null===(r=m.episodeMetadata)||void 0===r?void 0:r.airDate)?"Aired on ".concat(new Date(null===(d=m.episodeMetadata)||void 0===d?void 0:d.airDate).toLocaleDateString()):"Aired"]})})},(null===(u=e.episode.localFile)||void 0===u?void 0:u.path)||t)})})]}):null}function useVideoPlayer(){let{mutate:e}=(0,U.$U)({endpoint:O.E.PLAY_VIDEO}),t=(0,a.useCallback)(t=>{let{path:i}=t;return e({path:i})},[]);return{playVideo:t}}function usePlayNextVideoOnMount(e){let{onPlay:t}=e,i=(0,n.useRouter)(),l=(0,n.usePathname)(),o=(0,n.useSearchParams)(),s=o.get("playNext"),r=o.get("id");return(0,a.useEffect)(()=>{let e=setTimeout(()=>{s&&(i.replace(l+"?id=".concat(r)),t())},500);return()=>clearTimeout(e)},[l,r,s]),null}var e5=i(67998),e3=i(38038);function ProgressTracking(e){var t;let{entry:i}=e,n=(0,e3.NL)(),o=(0,eU.k)(!1),s=(0,eU.k)(!1),r=(0,eU.k)(!1),[d,c]=(0,a.useState)(null),u=(0,a.useMemo)(()=>{if(d){var e;return null===(e=i.episodes)||void 0===e?void 0:e.find(e=>{var t;return(null===(t=e.localFile)||void 0===t?void 0:t.name)===d.filename})}},[d,i.episodes]),g=(0,a.useMemo)(()=>{var e,t,l;return!!u&&(!(null===(e=i.listData)||void 0===e?void 0:e.progress)||!!(null===(t=i.listData)||void 0===t?void 0:t.progress)&&(null===(l=i.listData)||void 0===l?void 0:l.progress)<u.progressNumber)},[u,null===(t=i.listData)||void 0===t?void 0:t.progress]);(0,e5.SN)({type:O.f.MEDIA_PLAYER_TRACKING_STARTED,onMessage:e=>{s.on(),o.on(),r.active||(r.off(),c(e))}}),(0,e5.SN)({type:O.f.MEDIA_PLAYER_VIDEO_COMPLETED,onMessage:e=>{s.on(),o.on(),r.on(),c(e)}}),(0,e5.SN)({type:O.f.MEDIA_PLAYER_TRACKING_STOPPED,onMessage:e=>{"Closed"===e?eM.ZP.success("Player closed"):eM.ZP.error(e),r.active||(s.off(),o.off(),c(null))}});let{mutate:p,isPending:x}=(0,U.$U)({endpoint:O.E.ANILIST_LIST_ENTRY_PROGRESS,mutationKey:["update-anilist-list-entry-progress"],onSuccess:async()=>{eM.ZP.success("Progress updated"),c(null),r.off(),o.off(),await n.refetchQueries({queryKey:["get-media-entry",i.mediaId]}),await n.refetchQueries({queryKey:["get-library-collection"]}),await n.refetchQueries({queryKey:["get-anilist-collection"]})}});return(0,l.jsxs)(l.Fragment,{children:[s.active&&(0,l.jsx)(F.zx,{intent:"success",className:(0,v.cn)({"animate-pulse":r.active}),onClick:o.on,children:"Update progress"}),(0,l.jsxs)(z.u_,{isOpen:o.active,onClose:o.off,children:[(0,l.jsx)("div",{className:"bg-[--background-color] border border-[--border] rounded-md p-4 mb-4 text-center",children:d&&r.active&&u?(0,l.jsxs)("p",{className:"text-xl",children:["Current progress: ",(0,l.jsxs)(m.C,{size:"lg",children:[u.progressNumber," ",(0,l.jsxs)("span",{className:"opacity-60",children:["/ ",i.currentEpisodeCount]})]})]}):(0,l.jsx)("p",{children:"Currently watching"})}),(0,l.jsx)("div",{className:"flex gap-2 justify-center items-center",children:!!d&&r.active&&g&&(0,l.jsx)(F.zx,{intent:"primary",isDisabled:!1,onClick:()=>{p({mediaId:i.mediaId,progress:u.progressNumber})},isLoading:x,className:"w-full",children:"Confirm"})})]})]})}function EpisodeSection(e){var t,i;let{entry:n}=e,o=n.media,{playVideo:s}=useVideoPlayer();usePlayNextVideoOnMount({onPlay:()=>{if(n.nextEpisode){var e,t;s({path:null!==(t=null===(e=n.nextEpisode.localFile)||void 0===e?void 0:e.path)&&void 0!==t?t:""})}}});let r=(0,a.useMemo)(()=>{var e,t;return null!==(t=null===(e=n.episodes)||void 0===e?void 0:e.filter(e=>"main"===e.type))&&void 0!==t?t:[]},[n.episodes]),d=(0,a.useMemo)(()=>{var e,t;return null!==(t=null===(e=n.episodes)||void 0===e?void 0:e.filter(e=>"special"===e.type))&&void 0!==t?t:[]},[n.episodes]),c=(0,a.useMemo)(()=>{var e,t;return null!==(t=null===(e=n.episodes)||void 0===e?void 0:e.filter(e=>"nc"===e.type))&&void 0!==t?t:[]},[n.episodes]),u=(0,a.useMemo)(()=>{var e;let t=r.filter(e=>{var t,i;return!n.nextEpisode||e.progressNumber>(null!==(i=null===(t=n.listData)||void 0===t?void 0:t.progress)&&void 0!==i?i:0)});return(null===(e=n.listData)||void 0===e?void 0:e.progress)&&!n.nextEpisode?t.reverse():t},[r,n.nextEpisode,null===(t=n.listData)||void 0===t?void 0:t.progress]);return o?!o||n.listData&&n.libraryData?(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)(eR.ce,{spacing:"lg",children:[(0,l.jsxs)("div",{className:"mb-8 flex flex-col md:flex-row items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center gap-8",children:[(0,l.jsx)("h2",{children:"MOVIE"===o.format?"Movie":"Episodes"}),!!n.nextEpisode&&(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(F.zx,{size:"lg",intent:"white",rightIcon:(0,l.jsx)(eB.B,{}),iconClassName:"text-2xl",onClick:()=>{var e,t,i;return s({path:null!==(i=null===(t=n.nextEpisode)||void 0===t?void 0:null===(e=t.localFile)||void 0===e?void 0:e.path)&&void 0!==i?i:""})},children:"MOVIE"===o.format?"Watch":"Play next episode"})})]}),!!n.libraryData&&(0,l.jsxs)("div",{className:"space-x-4 flex items-center",children:[(0,l.jsx)(ProgressTracking,{entry:n}),(0,l.jsx)(BulkToggleLockButton,{entry:n}),(0,l.jsx)(EpisodeSectionMenu,{entry:n})]})]}),u.length>0&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(L.i,{children:u.map(e=>{var t;return(0,l.jsx)(e8,{episode:e,onPlay:s},(null===(t=e.localFile)||void 0===t?void 0:t.path)||"")})}),(0,l.jsx)(_.iz,{})]}),!(null===(i=n.episodes)||void 0===i?void 0:i.length)&&(0,l.jsx)("p",{children:"Not in your library"}),(0,l.jsxs)("div",{className:"space-y-10",children:[(0,l.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:r.map(e=>{var t,i;return(0,l.jsx)(eJ,{episode:e,media:o,isWatched:!!(null===(t=n.listData)||void 0===t?void 0:t.progress)&&n.listData.progress>=e.progressNumber,onPlay:s},(null===(i=e.localFile)||void 0===i?void 0:i.path)||"")})}),(0,l.jsx)(UndownloadedEpisodeList,{downloadInfo:n.downloadInfo,media:o}),d.length>0&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(_.iz,{}),(0,l.jsx)("h3",{children:"Specials"}),(0,l.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:d.map(e=>{var t;return(0,l.jsx)(eJ,{episode:e,media:o,onPlay:s},(null===(t=e.localFile)||void 0===t?void 0:t.path)||"")})})]}),c.length>0&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(_.iz,{}),(0,l.jsx)("h3",{children:"Others"}),(0,l.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:c.map(e=>{var t;return(0,l.jsx)(eJ,{episode:e,media:o,onPlay:s},(null===(t=e.localFile)||void 0===t?void 0:t.path)||"")})})]})]})]})}):(0,l.jsxs)("div",{className:"space-y-10",children:[(null==o?void 0:o.status)!=="NOT_YET_RELEASED"?(0,l.jsx)("p",{children:"Not in your library"}):(0,l.jsx)("p",{children:"Not yet released"}),(0,l.jsx)("div",{className:"overflow-y-auto pt-4 lg:pt-0 space-y-10",children:(0,l.jsx)(UndownloadedEpisodeList,{downloadInfo:n.downloadInfo,media:o})})]}):null}let e8=(0,a.memo)(e=>{var t,i,n;let{episode:o,onPlay:s}=e,r=(null===(t=o.episodeMetadata)||void 0===t?void 0:t.airDate)?new Date(o.episodeMetadata.airDate):void 0,d=(0,a.useMemo)(()=>r?(0,e2.Z)(r,(0,e1.Z)(new Date,2)):void 0,[]);return(0,l.jsx)(e4.S,{image:null===(i=o.episodeMetadata)||void 0===i?void 0:i.image,title:(0,l.jsxs)("span",{children:[o.displayTitle," ",!!(null===(n=o.basicMedia)||void 0===n?void 0:n.episodes)&&1!=o.basicMedia.episodes&&(0,l.jsxs)("span",{className:"opacity-40",children:["/"," ",o.basicMedia.episodes]})]}),topTitle:o.episodeTitle,actionIcon:void 0,meta:r?d?new Intl.DateTimeFormat("en-US",{day:"2-digit",month:"2-digit",year:"2-digit"}).format(r):"".concat((0,k.Z)(r,{addSuffix:!0})):void 0,onClick:()=>{var e,t;return s({path:null!==(t=null===(e=o.localFile)||void 0===e?void 0:e.path)&&void 0!==t?t:""})}})});function Page(){let e=(0,n.useRouter)(),t=(0,n.useSearchParams)(),i=t.get("id"),{mediaEntry:s,mediaEntryLoading:r}=(0,o.X7)(i),{mediaDetails:d,mediaDetailsLoading:c}=(0,o.Jg)(i);return((0,a.useEffect)(()=>{i&&(r||s)||e.push("/")},[s,r]),r||c)?(0,l.jsx)(LoadingDisplay,{}):s?(0,l.jsxs)("div",{children:[(0,l.jsx)(EntryHeaderBackground,{entry:s}),(0,l.jsxs)("div",{className:"-mt-[8rem] relative z-10 max-w-full px-4 md:px-10 grid grid-cols-1 2xl:grid-cols-2 gap-8 pb-16",children:[(0,l.jsx)("div",{className:"-mt-[18rem] h-[fit-content] 2xl:sticky top-[5rem] backdrop-blur-xl",children:(0,l.jsx)(MetaSection,{entry:s,details:d})}),(0,l.jsx)("div",{className:"relative 2xl:order-first pb-10",children:(0,l.jsx)(EpisodeSection,{entry:s})})]}),(0,l.jsx)(TorrentSearchDrawer,{entry:s})]}):null}function LoadingDisplay(){return(0,l.jsx)("div",{className:"__header h-[30rem]",children:(0,l.jsxs)("div",{className:"h-[30rem] w-full md:w-[calc(100%-5rem)] flex-none object-cover object-center absolute top-0 overflow-hidden",children:[(0,l.jsx)("div",{className:"w-full absolute z-[1] top-0 h-[15rem] bg-gradient-to-b from-[--background-color] to-transparent via"}),(0,l.jsx)(s.O,{className:"h-full absolute w-full"}),(0,l.jsx)("div",{className:"w-full absolute bottom-0 h-[20rem] bg-gradient-to-t from-[--background-color] via-transparent to-transparent"})]})})}},86679:function(e,t,i){"use strict";i.d(t,{VW:function(){return ToastProvider},pm:function(){return useToast}});var l=i(57437),n=i(9805),a=i(2265),o=i(5925),s=i(54487),r=i(97622),d=i(96061),c=i(11305);let u=(0,s.xH)({toast:(0,d.j)(["UI-Toast__toast","relative transform py-2 px-5 flex rounded-lg shadow-md","data-[type=error]:bg-red-500 data-[type=error]:text-white","data-[type=success]:bg-green-500 data-[type=success]:text-white","data-[type=loading]:bg-gray-50 dark:data-[type=loading]:bg-gray-800 data-[type=error]:text-white"]),content:(0,d.j)(["UI-Toast__content","h-full flex items-center"]),icon:(0,d.j)(["UI-Toast__icon","w-5 h-5"]),closeButton:(0,d.j)(["UI-Toast__closeButton","absolute top-1 right-1"])}),m=a.forwardRef((e,t)=>{let{t:i,toastClassName:a,closeButtonClassName:d,contentClassName:m,iconClassName:g}=e;return(0,l.jsxs)(n.u,{appear:!0,show:i.visible,className:(0,s.cn)(u.toast(),a),"data-type":i.type,enter:"transition-all duration-150",enterFrom:"opacity-0 scale-50",enterTo:"opacity-100 scale-100",leave:"transition-all duration-150",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-75",children:[(0,l.jsxs)("div",{className:(0,s.cn)(u.content(),m),children:["loading"!==i.type&&(0,l.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:(0,s.cn)(u.icon(),g),children:["error"===i.type&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,l.jsx)("line",{x1:"15",x2:"9",y1:"9",y2:"15"}),(0,l.jsx)("line",{x1:"9",x2:"15",y1:"9",y2:"15"})]}),"success"===i.type&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("path",{d:"M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"}),(0,l.jsx)("path",{d:"m9 12 2 2 4-4"})]})]}),"loading"===i.type&&(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(c.$j,{className:(0,s.cn)(u.icon(),g)})})]}),(0,l.jsx)("p",{className:"py-1 px-2 pr-6",children:(0,o.GK)(i.message,i)}),(0,l.jsx)(r.PZ,{className:(0,s.cn)(u.closeButton(),d),size:"sm",intent:"loading"!==i.type?"white-basic":"gray-basic",onClick:()=>o.ZP.dismiss(i.id)})]})}),ToastProvider=()=>(0,l.jsx)(o.x7,{children:e=>(0,l.jsx)(m,{t:e})}),useToast=()=>({success:e=>{o.ZP.success(null!=e?e:"")},error:e=>{o.ZP.error(null!=e?e:"")}})},34654:function(e,t,i){"use strict";i.d(t,{E:function(){return useDebounceWithSet},N:function(){return useDebounce}});var l=i(2265);function useDebounce(e,t){let[i,n]=(0,l.useState)(e);return(0,l.useEffect)(()=>{let i=setTimeout(()=>n(e),t||500);return()=>{clearTimeout(i)}},[e,t]),i}function useDebounceWithSet(e,t){let[i,n]=(0,l.useState)(e);return(0,l.useEffect)(()=>{let i=setTimeout(()=>n(e),t||500);return()=>{clearTimeout(i)}},[e,t]),[i,n]}},98602:function(e,t,i){"use strict";i.d(t,{$g:function(){return useDefaultSettingsPaths},VP:function(){return useOpenDefaultMediaPlayer},cg:function(){return useOpenInExplorer},tB:function(){return useOpenMediaEntryInExplorer}});var l=i(51472),n=i(57638);function useDefaultSettingsPaths(){return{getDefaultVlcPath:e=>{switch(e){case"windows":default:return"C:\\Program Files\\VideoLAN\\VLC\\vlc.exe";case"linux":return"/usr/bin/vlc";case"darwin":return"/Applications/VLC.app/Contents/MacOS/VLC"}},getDefaultQBittorrentPath:e=>{switch(e){case"windows":default:return"C:/Program Files/qBittorrent/qbittorrent.exe";case"linux":return"/usr/bin/qbittorrent";case"darwin":return"/Applications/Client.app/Contents/MacOS/qBittorrent"}}}}function useOpenDefaultMediaPlayer(){let{mutate:e}=(0,l.$U)({endpoint:n.E.START_MEDIA_PLAYER,mutationKey:["open-default-media-player"]});return{startDefaultMediaPlayer:()=>e()}}function useOpenMediaEntryInExplorer(){let{mutate:e}=(0,l.$U)({endpoint:n.E.OPEN_MEDIA_ENTRY_IN_EXPLORER,mutationKey:["open-media-entry-in-explorer"]});return{openEntryInExplorer:t=>e({mediaId:t})}}function useOpenInExplorer(){let{mutate:e}=(0,l.$U)({endpoint:n.E.OPEN_IN_EXPLORER,mutationKey:["open-in-explorer"]});return{openInExplorer:t=>e({path:t})}}}},function(e){e.O(0,[492,890,999,685,702,17,898,265,726,669,993,912,430,345,832,700,971,472,744],function(){return e(e.s=79261)}),_N_E=e.O()}]);